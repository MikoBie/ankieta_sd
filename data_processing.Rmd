---
title: "Wyniki ankiety SD UW"
output: 
  
  bookdown::html_document2:
    toc: yes
    toc_depth: 3
    toc_float: yes
  word_document: default
always_allow_html: yes
---

```{r markdown_setup, include=FALSE}
knitr::opts_chunk$set(
    echo = FALSE,
    message = FALSE,
    warning = FALSE,
    base.dir = here::here(),
    fig.path = "figures/",
    eval.after = 'fig.cap',
    fig.width = 8,
    fig.height = 4
)
```

```{r libraries}
library(tidyverse)
library(magrittr)
library(lubridate)
library(kableExtra)
library(DT)
source("utils/utils.R")
source("utils/maps.R")
#l <- get_png("png/samorzad_doktorantow_logo.png")
COLORS <- c("#123e65",
            "#B3160E",
            "#1F6608")
```





```{r get_data}
data <- read_csv("data/Ankieta dla doktorantów (Odpowiedzi) - Liczba odpowiedzi_ last.csv")

QUESTION_LOOKUP <- tibble(polski = colnames(data)[51:98],
                          english = colnames(data)[3:50]) %>%
  mutate(qn = paste0("qn_", 1:n())) %>%
  select(qn, polski, english) 

data <- read_csv("data/Ankieta dla doktorantów (Odpowiedzi) - Liczba odpowiedzi_ last.csv") %>%
  rename(time = "Sygnatura czasowa",
         language = "Please select the language (choose wisely)") %>%
  mutate(id = 1:n()) %>%
  select(id, time, language, everything()) %>%
  pivot_longer(cols = c(4:99),
               names_to = "questions",
               values_to = "responses",
               values_ptypes = list(responses = character())) %>%
  filter(time > ymd_hms("2020-04-14 15:30:00")) %>%
  group_by(id) %>% 
  mutate(language_help = rep(c("English", "Polski"), each = 48)) %>%
  ungroup() %>%
  filter(language == language_help) %>%
  group_by(id) %>%
  mutate(qn = paste0("qn_", 1:n()),
         responses = trimws(responses))
  

data_wide <- data %>%
  pivot_wider(id_cols = id:language,
              names_from = qn,
              values_from = responses) %>%
  select(id, time, language, affiliation = qn_1, position = qn_2, przewod =  qn_5, teaching =  qn_13, classes = qn_21, series = qn_47, everything(), c(-qn_1, -qn_2, -qn_5, -qn_13, -qn_21, -qn_47)) %>%
  mutate_at(vars(qn_3:qn_48), ~ifelse(. == "Yes", "Tak", .)) %>%
  mutate_at(vars(qn_3:qn_48), ~ifelse(. == "No", "Nie", .)) %>%
  mutate(qn_22 = recode(qn_22,
         "None" = "Ani jedne",
         "Less than a half" = "Mniej niż połowa",
         "Half" = "Połowa",
         "More than a half" = "Więcej niż połowa",
         "All" = "Wszystkie")) %>%
  mutate_at(vars(qn_3:qn_48), ~ifelse(. == "I have not been in contact with administration recently", "Nie miałam / miałem kontaktu z administracją w mojej jednostce w ostatnim czasie", .)) %>%
  mutate_at(vars(qn_3:qn_48), ~ifelse(. == "Nie miałam / miałem kontaktu z administracją w mojej jednostce w ostatnim czasie", "Brak kontaktu", .)) %>%
  mutate_at(vars(qn_3:qn_48), ~ifelse(. == "Nie miałam / miałem kontaktu z administracją uniwersytecką w ostatnim czasie", "Brak kontaktu", .)) %>%
  mutate_at(vars(qn_4,qn_7,qn_10,qn_12,qn_16,qn_18,qn_19,qn_25,qn_26,qn_32,qn_32,qn_33,qn_40,qn_45), ~str_replace_all(string = ., pattern = "pieprzone", replacement = "p*******")) %>%
  left_join(facculties_map) %>%
  mutate(position = if_else(
    position %in% c(
      "PhD student from doctoral school",
      "doktorantką / doktorantem ze szkoły doktorskiej"),
    "Szkoła Doktorska",
    "Studia Doktoranckie"),
    position = factor(position, levels = c("Szkoła Doktorska", "Studia Doktoranckie")),
    doctoral_school = case_when(
    position == "Szkoła Doktorska" & science_label %in% c(
      "Nauki Społeczne") ~ "Szkoła Doktorska Nauk Społecznych",
    position == "Szkoła Doktorska" & science_label %in% c(
      "Nauki Humanistyczne") ~ "Szkoła Doktorska Nauk Humanistycznych",
    position == "Szkoła Doktorska" & science_label %in% c(
      "Nauki Ścisłe i Przyrodnicze") ~ "Szkoła Doktorska Nauk Ścisłych i Przyrodniczych",
    TRUE ~ "Międzydziedzinowa Szkoła Doktorska"
    ),
    doctoral_school = if_else(position == "Szkoła Doktorska",
                              doctoral_school,
                              "")) %>%
  mutate(scale = SCALE_MAP[qn_37 %>% as.numeric()] %>% names()) %>%
  left_join(contact_map)
  
         
```

# Wstęp

Wyniki ankiety są podzielone na 12 różnych kategorii. Po lewej stronie znajduje się menu, w którym wypisane są wszystkie kategorie. W większości kategorii można wybrać jedną z trzech możliwości: 

* wyświetlić wyniki na wykresach słupkowych, 
* wyświetlić wyniki w tabelach (to jest to samo co na wykresach, choć można tam znaleźć brakujące w opisach liczebności),
* wyświetlić tabele z odpowiedziami na pytania otwarte (nad każdą kolumną można wybrać filtr na podstawie, którego chce się przefiltrować odpowiedzi). 

W opisach wykresów i tabeli znajduje się podsumowanie przedstawionych w nich najważniejszych informacji.

# Ankietowani {.tabset}

## Wykresy

```{r affiliation-plot, fig.height = 6, layout="l-body-outset", fig.cap=cap}
cap <- sprintf(
  "W Ankiecie wzięło udział w sumie %.0f doktorantek i doktorantów, z czego %.0f kształci się na studiach doktoranckich, a %.0f w szkołach doktorskich. Najliczniejszą reprezentację w badaniu miał %s, z którego w ankiecie wzięło udział %i doktorantek i doktorantów.",
  data_wide %>% nrow,
  compute_number(question = position, response = "Studia Doktoranckie"),
  compute_number(question = position, response = "Szkoła Doktorska"),
  data_wide %>% group_by(faculty_label) %>% summarise(count = n()) %>% arrange(desc(count)) %>% slice(1) %>% pull(faculty_label),
  data_wide %>% group_by(faculty_label) %>% summarise(count = n()) %>% arrange(desc(count)) %>% slice(1) %>% pull(count)
  )

order_faculties <- data_wide %>%
  filter(!is.na(faculty_label)) %>%
  group_by(faculty_shortcut) %>%
  filter(!faculty_shortcut %in% c("MSD UW", "SDNS UW", "SDNH UW", "SDNŚiP UW")) %>%
  summarise(count = n()) %>%
  arrange(count) %$%
  faculty_shortcut

data_wide %>%
  filter(!is.na(faculty_label)) %>%
  filter(! faculty_shortcut %in% c("MSD UW", "SDNS UW", "SDNH UW", "SDNŚiP UW")) %>%
  mutate(label = factor(faculty_shortcut, levels = order_faculties),
         position = factor(position, levels = c("Szkoła Doktorska", "Studia Doktoranckie" ))) %>%
  ggplot(aes(x = label, fill = position)) +
  geom_bar() +
  theme_classic() +
  labs(x = "", y = "Liczebność")+ 
  #annotation_custom(l, xmin = -1, xmax = 4, ymin = 45, ymax = 60) + 
  #coord_cartesian(clip = "off") +
  coord_flip() +
  scale_y_continuous(expand = expansion(mult = c(0, .1))) +
  scale_fill_manual(values=COLORS[1:2], limits = c("Studia Doktoranckie", "Szkoła Doktorska")) +
  theme(legend.position="bottom", legend.title = element_blank())
```

```{r science-plot, layout="l-body-outset", fig.cap=cap}
order_sciencies <- data_wide %>%
  filter(science_label != "") %>%
  group_by(science_label) %>%
  summarise(count = n()) %>%
  arrange(count) %$%
  science_label

data_wide %>%
  filter(science_label != "") %>%
  mutate(label = factor(science_label, levels = order_sciencies),
         position = factor(position, levels = c("Szkoła Doktorska", "Studia Doktoranckie" ))) %>%
  ggplot(aes(x = label, fill = position)) +
  geom_bar() +
  theme_classic() +
  labs(x = "", y = "Liczebność")+ 
  #annotation_custom(l, xmin = -3, xmax = 4, ymin = 165, ymax = 195) + 
  #coord_cartesian(clip = "off") +
  coord_flip() +
  scale_y_continuous(expand = expansion(mult = c(0, .1))) +
  scale_fill_manual(values=COLORS[1:2], limits = c("Studia Doktoranckie", "Szkoła Doktorska")) +
  theme(legend.position="bottom", legend.title = element_blank())
cap <- sprintf(
  "Z %i doktorantek i doktorantów, którzy wzięli udział w badaniu najwięcej reprezentowało %s - %i; %s reprezentowało %i, a %s - %i (dla 10 doktorantek i doktorantów nie udało się ustalić dziedziny nauki).",
  data_wide %>% nrow,
  data_wide %>% group_by(science_label) %>% summarise(count = n()) %>% arrange(desc(count)) %>% slice(1) %>% pull(science_label),
  data_wide %>% group_by(science_label) %>% summarise(count = n()) %>% arrange(desc(count)) %>% slice(1) %>% pull(count),
  data_wide %>% group_by(science_label) %>% summarise(count = n()) %>% arrange(desc(count)) %>% slice(2) %>% pull(science_label),
  data_wide %>% group_by(science_label) %>% summarise(count = n()) %>% arrange(desc(count)) %>% slice(2) %>% pull(count),
  data_wide %>% group_by(science_label) %>% summarise(count = n()) %>% arrange(desc(count)) %>% slice(3) %>% pull(science_label),
  data_wide %>% group_by(science_label) %>% summarise(count = n()) %>% arrange(desc(count)) %>% slice(3) %>% pull(count))
```

## Tabela

```{r affiliation-table, layout="l-body-outset"}
cap <- sprintf(
  "W Ankiecie wzięło udział w sumie %.0f doktorantek i doktorantów, z czego %.0f kształci się na studiach doktoranckich, a %.0f w szkołach doktorskich. Najliczniejszą reprezentację w badaniu miał %s, z którego w ankiecie wzięło udział %i doktorantek i doktorantów.",
  data_wide %>% nrow,
  compute_number(question = position, response = "Studia Doktoranckie"),
  compute_number(question = position, response = "Szkoła Doktorska"),
  data_wide %>% group_by(faculty_label) %>% summarise(count = n()) %>% arrange(desc(count)) %>% slice(1) %>% pull(faculty_label),
  data_wide %>% group_by(faculty_label) %>% summarise(count = n()) %>% arrange(desc(count)) %>% slice(1) %>% pull(count)
  )

data_wide %>%
  filter(!is.na(faculty_label)) %>%
  filter(! faculty_shortcut %in% c("MSD UW", "SDNS UW", "SDNH UW", "SDNŚiP UW")) %>%
  group_by(faculty_label, position) %>%
  summarise(Liczebność = n()) %>%
  arrange(faculty_label) %>%
  rename(Jednostka = faculty_label,
         "Rodzaj kształcenia" = position) %>%
  pivot_wider(names_from = "Rodzaj kształcenia",
              values_from = "Liczebność") %>%
   kable(caption = cap, "html") %>%
      kable_styling(bootstrap_options = c("striped","hover"),
                    font_size = 10,
                    full_width = TRUE)
      
```

# Stypendia {.tabset}

## Wykresy

**`r question_show(question = "qn_3")`**

```{r przewod-plot, layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_3,
                   conditional = TRUE,
                   question2 = qn_3,
                   legend = FALSE,
                   reorder = FALSE,
                   ymin = 195,
                   ymax = 225,
                   COLORS = COLORS[2:1])
cap <- sprintf(
  "Wśród %i doktorantek i doktorantów, którzy przygotowują rozprawę doktorską w ramach studiów doktoranckich, ponad połowa (%i) obawia się, że w związku z pandemią koronawirusa może mieć problem z otrzymaniem stypendium w przyszłym roku akademickim.",
  compute_number(question = qn_3, response = "Tak") + compute_number(question = qn_3, response = "Nie"),
  compute_number(question = qn_3, response = "Tak"))
```

**`r question_show(question = "qn_3")`**

```{r przewod-plot-2, layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_3,
                   conditional = TRUE,
                   question2 = qn_34,
                   legend = TRUE,
                   reorder = FALSE,
                   ymin = 195,
                   ymax = 225,
                   COLORS = COLORS[2:1],
                   legend_title = question_show(question = "qn_34"))
cap <- sprintf(
  "Wśród %i doktorantek i doktorantów, którzy obawiają się, że w związku z pandemią koronawirusa mogą mieć problem z uzyskaniem stypendium w przyszłym roku akademickim, %i utraciło źródło dochodu w konsekwencji restrykcji wprowadzonych przez Rząd. W grupie %i doktorantek i doktorantów, którzy nie obawiają się, że w związku z pandemią koronawirusa mogą mieć problem z uzyskaniem stypendium w przyszłym roku akademickim, %i utraciło źródło dochodu.",
  compute_number(question = qn_3, response = "Tak"),
  compute_number(question = qn_3, response = "Tak", conditional = TRUE, question2 = qn_34, response2 = "Tak"),
  compute_number(question = qn_3, response = "Nie"),
  compute_number(question = qn_3, response = "Nie", conditional = TRUE, question2 = qn_34, response2 = "Tak"))
```

## Tabele

```{r przewod-table-2, layout="l-body-outset"}
cap <- sprintf(
  "Wśród %i doktorantek i doktorantów, którzy obawiają się, że w związku z pandemią koronawirusa mogą mieć problem z uzyskaniem stypendium w przyszłym roku akademickim, %i utraciło źródło dochodu w konsekwencji restrykcji wprowadzonych przez Rząd. W grupie %i doktorantek i doktorantów, którzy nie obawiają się, że w związku z pandemią koronawirusa mogą mieć problem z uzyskaniem stypendium w przyszłym roku akademickim, %i utraciło źródło dochodu.",
  compute_number(question = qn_3, response = "Tak"),
  compute_number(question = qn_3, response = "Tak", conditional = TRUE, question2 = qn_34, response2 = "Tak"),
  compute_number(question = qn_3, response = "Nie"),
  compute_number(question = qn_3, response = "Nie", conditional = TRUE, question2 = qn_34, response2 = "Tak"))
make_table(question = qn_3,
           conditional = TRUE,
           question2 = qn_34,
           cap = cap)

```

## Otwarte

```{r qn4-table, layout="l-body-outset"}
make_open_table(question = qn_4,
                defualt_cap = FALSE,
                custom_cap = "Jeśli odpowiedziałaś / odpowiedziałeś ,,Tak’’ w pytaniu dotyczącym obniżenia szans na uzyskanie stypendium naukowego w przyszłym roku akademickim, to napisz na czym polega ten problem i co Uniwersytet Warszawski może zrobić, żeby pomóc Ci go rozwiązać? Czy np. zmiana kryteriów przyznawania stypendiów mogłaby być przydatna? Jeśli tak, na czym miałaby polegać ta zmiana?")
```

# Obrona przed 2021 {.tabset}

## Wykresy

**`r question_show(question = "qn_6")`**

```{r obrona-plot,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_6,
                   conditional = TRUE,
                   question2 = science_label,
                   COLORS = COLORS[1:3],
                   legend = TRUE)
cap <- sprintf(
  "Z %i doktorantek i doktorantów, którzy mają otwarty przewód doktorski ponad połowa (%i) uważa, że aktualna sytuacja może utrudnić im obronę przed grudniem 2021. Najwięcej bo %i doktorantek i doktorantów, którzy obawiają czy zdążą się obronić przed grudniem 2021 reprezentuje Nauki Humanistyczne, Nauki Społeczne - %i, a Nauki Ścisłe i Przyrodnicze - %i (u dwóch osób ciężko jest zidentyfikować dziedzinę nauki).",
  compute_number(question = qn_6, response = "Tak") + compute_number(question = qn_6, response = "Nie"),
  compute_number(question = qn_6, response = "Tak"),
  compute_number(question = qn_6, response = "Tak", conditional = TRUE, question2 = science_label, response2 = "Nauki Humanistyczne"),
  compute_number(question = qn_6, response = "Tak", conditional = TRUE, question2 = science_label, response2 = "Nauki Społeczne"),
  compute_number(question = qn_6, response = "Tak", conditional = TRUE, question2 = science_label, response2 = "Nauki Ścisłe i Przyrodnicze")
  )
```

**`r question_show(question = "qn_6")`**

```{r obrona-plot-2,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_6,
                   conditional = TRUE,
                   question2 = qn_39,
                   COLORS = COLORS[2:1],
                   legend = TRUE,
                   legend_title = question_show(question = "qn_39"))
cap <- sprintf(
  "Z %i doktorantek i doktorantów, którzy mają otwarty przewód doktorski ponad połowa (%i) uważa, że aktualna sytuacja może utrudnić im obronę przed grudniem 2021. Co więcej dla większości tych doktorantów i doktorantek (%i!) ograniczenia związane z pandemią koronawirusa, w tym te w funkcjonowaniu Uniwersytetu Warszawskiego, wpływają na realizację badań w przygotowywanej rozprawie doktorskiej. W przypadku osób, które nie obawiają się wpływu pandemii na obronę przed grudniem 2021, nie może realizować badań do doktoratu ponad połowa - %i.",
  compute_number(question = qn_6, response = "Tak") + compute_number(question = qn_6, response = "Nie"),
  compute_number(question = qn_6, response = "Tak"),
  compute_number(question = qn_6, response = "Tak", conditional = TRUE, question2 = qn_39, response2 = "Tak"),
  compute_number(question = qn_6, response = "Nie", conditional = TRUE, question2 = qn_39, response2 = "Tak")
  )
```

**`r question_show(question = "qn_6")`**

```{r obrona-plot-3,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_6,
                   conditional = TRUE,
                   question2 = scale,
                   COLORS = COLORS[2:1],
                   legend = TRUE,
                   legend_title = "Na ile zmienił się Twój kontakt z Promotorem / Promotorką?")
cap <- sprintf(
  "Z %i doktorantek i doktorantów, którzy mają otwarty przewód doktorski ponad połowa (%i) uważa, że aktualna sytuacja może utrudnić im obronę przed grudniem 2021. Jednak tylko %i doktorantek i doktorantów, którzy będą mieć ten problem, jednocześnie uważa, ze ich kontakt z Promotorem / Promotorką się pogorszył.",
  compute_number(question = qn_6, response = "Tak") + compute_number(question = qn_6, response = "Nie"),
  compute_number(question = qn_6, response = "Tak"),
  compute_number(question = qn_6, response = "Tak", conditional = TRUE, question2 = scale, response2 = "Jest gorzej")
  )
```

**`r question_show(question = "qn_6")`**

```{r obrona-plot-4,  layout="l-body-outset", fig.cap=cap}
cap <- sprintf(
  "Z %i doktorantek i doktorantów, którzy mają otwarty przewód doktorski ponad połowa (%i) uważa, że aktualna sytuacja może utrudnić im obronę przed grudniem 2021. Jednak tylko %i doktorantek i doktorantów, którzy będą mieć ten problem, jednocześnie obawia się, że będzie mieć problem z terminową realizacją kształcenia na studiach doktoranckich.",
  compute_number(question = qn_6, response = "Tak") + compute_number(question = qn_6, response = "Nie"),
  compute_number(question = qn_6, response = "Tak"),
  compute_number(question = qn_6, response = "Tak", conditional = TRUE, question2 = qn_44, response2 = "Tak"))

plot_con_questions(question = qn_6,
                   conditional = TRUE,
                   question2 = qn_44,
                   legend_title = question_show(question = "qn_44"),
                   COLOR = COLORS[2:1],
                   ymin = 300,
                   ymax = 330)
```

## Tabele

```{r obrona-table,  layout="l-body-outset"}
cap <- sprintf(
  "Z %i doktorantek i doktorantów, którzy mają otwarty przewód doktorski ponad połowa (%i) uważa, że aktualna sytuacja może utrudnić im obronę przed grudniem 2021. Najwięcej bo %i doktorantek i doktorantów, którzy obawiają czy zdążą się obronić przed grudniem 2021 reprezentuje Nauki Humanistyczne, Nauki Społeczne - %i, a Nauki Ścisłe i Przyrodnicze - %i (u dwóch osób ciężko jest zidentyfikować dziedzinę nauki).",
  compute_number(question = qn_6, response = "Tak") + compute_number(question = qn_6, response = "Nie"),
  compute_number(question = qn_6, response = "Tak"),
  compute_number(question = qn_6, response = "Tak", conditional = TRUE, question2 = science_label, response2 = "Nauki Humanistyczne"),
  compute_number(question = qn_6, response = "Tak", conditional = TRUE, question2 = science_label, response2 = "Nauki Społeczne"),
  compute_number(question = qn_6, response = "Tak", conditional = TRUE, question2 = science_label, response2 = "Nauki Ścisłe i Przyrodnicze")
  )
data_wide %>%
  filter(!is.na(qn_6)) %>%
  filter(science_label != "") %>%
  group_by(qn_6, science_label) %>%
  summarise(Liczebność = n()) %>%
  arrange(desc(Liczebność)) %>%
  rename("Dziedzina nauki" = science_label,
         !!question_show(question = "qn_6") := qn_6) %>%
   kable(caption = cap, "html") %>%
      kable_styling(bootstrap_options = c("striped","hover"),
                    font_size = 10,
                    full_width = TRUE)
  
```

```{r obrona-table-2,  layout="l-body-outset"}
cap <- sprintf(
  "Z %i doktorantek i doktorantów, którzy mają otwarty przewód doktorski ponad połowa (%i) uważa, że aktualna sytuacja może utrudnić im obronę przed grudniem 2021. Co więcej dla większości tych doktorantów i doktorantek (%i!) ograniczenia związane z pandemią koronawirusa, w tym te w funkcjonowaniu Uniwersytetu Warszawskiego, wpływają na realizację badań w przygotowywanej rozprawie doktorskiej. W przypadku osób, które nie obawiają się wpływu pandemii na obronę przed grudniem 2021, nie może realizować badań do doktoratu ponad połowa - %i.",
  compute_number(question = qn_6, response = "Tak") + compute_number(question = qn_6, response = "Nie"),
  compute_number(question = qn_6, response = "Tak"),
  compute_number(question = qn_6, response = "Tak", conditional = TRUE, question2 = qn_39, response2 = "Tak"),
  compute_number(question = qn_6, response = "Nie", conditional = TRUE, question2 = qn_39, response2 = "Tak")
  )
make_table(question = qn_6,
           conditional = TRUE,
           question2 = qn_39,
           cap = cap)
```

```{r obrona-table-3,  layout="l-body-outset"}
cap <- sprintf(
  "Z %i doktorantek i doktorantów, którzy mają otwarty przewód doktorski ponad połowa (%i) uważa, że aktualna sytuacja może utrudnić im obronę przed grudniem 2021. Jednak tylko %i doktorantek i doktorantów, którzy będą mieć ten problem, jednocześnie uważa, ze ich kontakt z Promotorem / Promotorką się pogorszył.",
  compute_number(question = qn_6, response = "Tak") + compute_number(question = qn_6, response = "Nie"),
  compute_number(question = qn_6, response = "Tak"),
  compute_number(question = qn_6, response = "Tak", conditional = TRUE, question2 = scale, response2 = "Jest gorzej")
  )
data_wide %>%
  filter(!is.na(qn_6)) %>%
  filter(scale != "") %>%
  group_by(qn_6, scale) %>%
  summarise(Liczebność = n()) %>%
  arrange(desc(Liczebność)) %>%
  rename("Na ile zmienił się Twój kontakt z Promotorem / Promotorką?" = scale,
         !!question_show(question = "qn_6") := qn_6) %>%
   kable(caption = cap, "html") %>%
      kable_styling(bootstrap_options = c("striped","hover"),
                    font_size = 10,
                    full_width = TRUE)
```
```{r obrona-table-4,  layout="l-body-outset"}
cap <- sprintf(
  "Z %i doktorantek i doktorantów, którzy mają otwarty przewód doktorski ponad połowa (%i) uważa, że aktualna sytuacja może utrudnić im obronę przed grudniem 2021. Jednak tylko %i doktorantek i doktorantów, którzy będą mieć ten problem, jednocześnie obawia się, że będzie mieć problem z terminową realizacją kształcenia na studiach doktoranckich.",
  compute_number(question = qn_6, response = "Tak") + compute_number(question = qn_6, response = "Nie"),
  compute_number(question = qn_6, response = "Tak"),
  compute_number(question = qn_6, response = "Tak", conditional = TRUE, question2 = qn_44, response2 = "Tak"))
make_table(question = qn_6,
           conditional = TRUE,
           question2 = qn_44,
           cap = cap)
```

## Otwarte

```{r qn7-table, layout="l-body-outset"}
make_open_table(question = qn_7,
                defualt_cap = FALSE,
                custom_cap = "Jeśli odpowiedziałaś / odpowiedziałeś ,,Tak’’ w pytaniu dotyczącym problemów z obroną przed grudniem 2021, to napisz na czym polega ten problem i co Uniwersytet Warszawski może zrobić, żeby pomóc Ci go rozwiązać?")
```

```{r table-qn40-przewod}
temp_table <- data_wide %>%
  filter(!is.na(qn_6))
make_open_table(table = temp_table,
                question = qn_40,
                defualt_cap = FALSE,
                custom_cap = "Jeśli odpowiedziałaś / odpowiedziałeś ,,Tak'' w pytaniu dotyczącym wpływu ograniczeń na realizowane przez Ciebie badania, to napisz na czym polega ten problem i co Uniwersytet Warszawski może zrobić, żeby pomóc Ci go rozwiązać?")
```

```{r table-qn45-przewod}
temp_table <- data_wide %>%
  filter(!is.na(qn_6))
make_open_table(table = temp_table,
                question = qn_45,
                defualt_cap = FALSE,
                custom_cap = "Jeśli odpowiedziałaś / odpowiedziałeś ,,Tak'' w pytaniu dotyczącym wpływu ograniczeń na Twoją możliwość terminowej realizacji programu studiów doktoranckich, to napisz na czym polega ten problem i co Uniwersytet Warszawski może zrobić, żeby pomóc Ci go rozwiązać?")
```

# Procedura Nadania Stopnia {.tabset}

## Wykresy

**`r question_show(question = "qn_9")`**

```{r obrona-procedura,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_9,
                   conditional = TRUE,
                   question2 = qn_8,
                   legend_title = question_show(question = "qn_8"),
                   COLORS = COLORS[2:1],
                   ymin = 170,
                   ymax = 200)
cap <- sprintf(
  "Z %i doktorantek i doktorantów, którzy są na studiach doktoranckich i nie mają otwartego przewodu, zdecydowana większość (%i) uważa, że aktualna sytuacja nie wpłynie na ich plany rozpoczęcia procedury nadania stopnia doktora. Jednak warto zauważyć, że aż %i z %i osób, które uważają, że aktualna sytuacja wpłynie na procedurę rozpoczęcia nadania stopnia doktora planowało wszcząć procedurę nadania stopnia doktora, w tym roku akademickim.",
  compute_number(question = qn_9, response = "Tak") + compute_number(question = qn_9, response = "Nie"),
  compute_number(question = qn_9, response = "Nie"), compute_number(question = qn_9, response = "Tak", conditional = TRUE, question2 = qn_8, response2 = "Tak"),
  compute_number(question = qn_9, response = "Tak"))
```

**`r question_show(question = "qn_9")`**

```{r obrona-procedura-2,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_9,
                   conditional = TRUE,
                   question2 = qn_39,
                   COLORS = COLORS[2:1],
                   legend = TRUE,
                   legend_title = question_show(question = "qn_39"))
cap <- sprintf(
  "Z %i doktorantek i doktorantów, którzy nie mają otwartego przewodu doktorskiego, zdecydowana większość  (%i) uważa, że aktualna sytuacja nie wpłynie na wszczęcie przez nich procedury nadania stopnia doktora. Jednak aż dla %i z %i osób, dla których ograniczenia związane z pandemią koronawirusa wpływają na wszczęcie procedury nadania stopnia doktora, ograniczenia wpływają równocześnie na przeprowadzenie badań do przygotowywanej rozprawie doktorskiej. W przypadku osób, które nie obawiają się wpływu pandemii na wszczęcie procedury nadania stopnia doktora, aż %i nie może realizować badań.",
  compute_number(question = qn_9, response = "Tak") + compute_number(question = qn_9, response = "Nie"),
  compute_number(question = qn_9, response = "Nie"),
  compute_number(question = qn_9, response = "Tak", conditional = TRUE, question2 = qn_39, response2 = "Tak"),
  compute_number(question = qn_9, response = "Tak"),
  compute_number(question = qn_9, response = "Nie", conditional = TRUE, question2 = qn_39, response2 = "Tak")
  )
```

**`r question_show(question = "qn_9")`**

```{r obrona-procedura-3,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_9,
                   conditional = TRUE,
                   question2 = scale,
                   COLORS = COLORS[2:1],
                   legend = TRUE,
                   legend_title = "Na ile zmienił się Twój kontakt z Opiekunką / Opiekunem noaukowym?")
cap <- sprintf(
  "Z %i doktorantek i doktorantów, którzy nie mają otwartego przewodu doktorskiego, zdecydowana większość  (%i) uważa, że aktualna sytuacja nie wpłynie na wszczęcie przez nich procedury nadania stopnia doktora. Tylko %i doktorantek i doktorantów, którzy będą mieć ten problem, jednocześnie uważa, ze ich kontakt z Promotorem / Promotorką się pogorszył.",
  compute_number(question = qn_9, response = "Tak") + compute_number(question = qn_9, response = "Nie"),
  compute_number(question = qn_9, response = "Nie"),
  compute_number(question = qn_9, response = "Tak", conditional = TRUE, question2 = scale, response2 = "Jest gorzej")
  )
```

**`r question_show(question = "qn_9")`**

```{r obrona-procedura-4,  layout="l-body-outset", fig.cap=cap}
cap <- sprintf(
  "Z %i doktorantek i doktorantów, którzy nie mają otwartego przewodu doktorskiego, zdecydowana większość  (%i) uważa, że aktualna sytuacja nie wpłynie na wszczęcie przez nich procedury nadania stopnia doktora. Jednak prawie połowa (%i z %i) doktorantek i doktorantów, którzy będą mieć ten problem, jednocześnie obawia się, że będzie mieć problem z terminową realizacją kształcenia na studiach doktoranckich.",
  compute_number(question = qn_9, response = "Tak") + compute_number(question = qn_9, response = "Nie"),
  compute_number(question = qn_9, response = "Nie"),
  compute_number(question = qn_9, response = "Tak", conditional = TRUE, question2 = qn_44, response2 = "Tak"),
  compute_number(question = qn_9, response = "Tak"))

plot_con_questions(question = qn_9,
                   conditional = TRUE,
                   question2 = qn_44,
                   legend_title = question_show(question = "qn_44"),
                   COLOR = COLORS[2:1],
                   ymin = 300,
                   ymax = 330)
```

## Tabele

```{r obrona-procedura-table,  layout="l-body-outset", fig.cap=cap}
cap <- sprintf(
  "Z %i doktorantek i doktorantów, którzy są na studiach doktoranckich i nie mają otwartego przewodu, zdecydowana większość (%i) uważa, że aktualna sytuacja nie wpłynie na ich plany rozpoczęcia procedury nadania stopnia doktora. Jednak warto zauważyć, że aż %i z %i osób, które uważają, że aktualna sytuacja wpłynie na procedurę rozpoczęcia nadania stopnia doktora planowało wszcząć procedurę nadania stopnia doktora, w tym roku akademickim.",
  compute_number(question = qn_9, response = "Tak") + compute_number(question = qn_9, response = "Nie"),
  compute_number(question = qn_9, response = "Nie"), compute_number(question = qn_9, response = "Tak", conditional = TRUE, question2 = qn_8, response2 = "Tak"),
  compute_number(question = qn_9, response = "Tak"))
make_table(question = qn_9,
           conditional = TRUE,
           question2 = qn_8,
           cap = cap)
```

```{r obrona-procedura-table-2,  layout="l-body-outset", fig.cap=cap}
cap <- sprintf(
  "Z %i doktorantek i doktorantów, którzy nie mają otwartego przewodu doktorskiego, zdecydowana większość  (%i) uważa, że aktualna sytuacja nie wpłynie na wszczęcie przez nich procedury nadania stopnia doktora. Jednak aż dla %i z %i osób, dla których ograniczenia związane z pandemią koronawirusa wpływają na wszczęcie procedury nadania stopnia doktora, ograniczenia wpływają równocześnie na przeprowadzenie badań do przygotowywanej rozprawie doktorskiej. W przypadku osób, które nie obawiają się wpływu pandemii na wszczęcie procedury nadania stopnia doktora, aż %i nie może realizować badań.",
  compute_number(question = qn_9, response = "Tak") + compute_number(question = qn_9, response = "Nie"),
  compute_number(question = qn_9, response = "Nie"),
  compute_number(question = qn_9, response = "Tak", conditional = TRUE, question2 = qn_39, response2 = "Tak"),
  compute_number(question = qn_9, response = "Tak"),
  compute_number(question = qn_9, response = "Nie", conditional = TRUE, question2 = qn_39, response2 = "Tak")
  )
make_table(question = qn_9,
           conditional = TRUE,
           question2 = qn_39,
           cap = cap)
```

```{r obrona-procedura-table-3,  layout="l-body-outset", fig.cap=cap}
cap <- sprintf(
  "Z %i doktorantek i doktorantów, którzy nie mają otwartego przewodu doktorskiego, zdecydowana większość  (%i) uważa, że aktualna sytuacja nie wpłynie na wszczęście przez nich procedury nadania stopnia doktora. Tylko %i doktorantek i doktorantów, którzy będą mieć ten problem, jednocześnie uważa, ze ich kontakt z Promotorem / Promotorką się pogorszył.",
  compute_number(question = qn_9, response = "Tak") + compute_number(question = qn_9, response = "Nie"),
  compute_number(question = qn_9, response = "Nie"),
  compute_number(question = qn_9, response = "Tak", conditional = TRUE, question2 = scale, response2 = "Jest gorzej")
  )
data_wide %>%
  filter(!is.na(qn_9)) %>%
  filter(scale != "") %>%
  group_by(qn_9, scale) %>%
  summarise(Liczebność = n()) %>%
  arrange(desc(Liczebność)) %>%
  rename("Na ile zmienił się Twój kontakt z Promotorem / Promotorką?" = scale,
         !!question_show(question = "qn_9") := qn_9) %>%
   kable(caption = cap, "html") %>%
      kable_styling(bootstrap_options = c("striped","hover"),
                    font_size = 10,
                    full_width = TRUE)
```

```{r obrona-procedura-table-4,  layout="l-body-outset", fig.cap=cap}
cap <- sprintf(
  "Z %i doktorantek i doktorantów, którzy nie mają otwartego przewodu doktorskiego, zdecydowana większość  (%i) uważa, że aktualna sytuacja nie wpłynie na wszczęście przez nich procedury nadania stopnia doktora. Jednak prawie połowa (%i z %i) doktorantek i doktorantów, którzy będą mieć ten problem, jednocześnie obawia się, że będzie mieć problem z terminową realizacją kształcenia na studiach doktoranckich.",
  compute_number(question = qn_9, response = "Tak") + compute_number(question = qn_9, response = "Nie"),
  compute_number(question = qn_9, response = "Nie"),
  compute_number(question = qn_9, response = "Tak", conditional = TRUE, question2 = qn_44, response2 = "Tak"),
  compute_number(question = qn_9, response = "Tak"))
make_table(question = qn_9,
           conditional = TRUE,
           question2 = qn_44,
           cap = cap)
```

## Otwarte

```{r qn10-table, layout="l-body-outset"}
make_open_table(question = qn_10,
                defualt_cap = FALSE,
                custom_cap = "Jeśli odpowiedziałaś / odpowiedziałeś ,,Tak’’ w pytaniu dotyczącym problemów z wszczęciem postępowania nadania stopnia doktora, to napisz na czym polega ten problem i co Uniwersytet Warszawski może zrobić, żeby pomóc Ci go rozwiązać?")
```

```{r table-qn40-procedura}
temp_table <- data_wide %>%
  filter(!is.na(qn_9))
make_open_table(table = temp_table,
                question = qn_40,
                defualt_cap = FALSE,
                custom_cap = "Jeśli odpowiedziałaś / odpowiedziałeś ,,Tak'' w pytaniu dotyczącym wpływu ograniczeń na realizowane przez Ciebie badania, to napisz na czym polega ten problem i co Uniwersytet Warszawski może zrobić, żeby pomóc Ci go rozwiązać?")
```

```{r table-qn45-procedura}
temp_table <- data_wide %>%
  filter(!is.na(qn_9))
make_open_table(table = temp_table,
                question = qn_45,
                defualt_cap = FALSE,
                custom_cap = "Jeśli odpowiedziałaś / odpowiedziałeś ,,Tak'' w pytaniu dotyczącym wpływu ograniczeń na Twoją możliwość terminowej realizacji programu studiów doktoranckich, to napisz na czym polega ten problem i co Uniwersytet Warszawski może zrobić, żeby pomóc Ci go rozwiązać?")
```

# IPB {.tabset}

## Wykresy

**`r question_show(question = "qn_11")`**

```{r obrona-plan,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_11,
                   conditional = TRUE,
                   question2 = science_label,
                   COLORS = COLORS,
                   legend = TRUE,
                   ymax = 54,
                   ymin = 47)
cap <- sprintf(
  "Z %i doktorantek i doktorantów kształcących się w szkołach doktorskich, połowa (%i) spodziewa się, że w związku z ogłoszoną decyzją o wprowadzeniu zdalnego nauczania na Uniwersytecie Warszawskim do 15 maja 2020 oraz szeregiem ograniczeń w tym semestrze, będzie miała problem z przygotowaniem Indywidualnego Planu Badawczego. Najwięcej takich doktorantek i doktorantów reprezentuje Nauki Humanistyczne - %i, Nauki Ścisłe i Przyrodnicze - %i, a Nauki Społeczne - %i (u jednej osoby ciężko było zidentyfikować dziedzinę nauki).",
  compute_number(question = qn_11, response = "Tak") + compute_number(question = qn_11, response = "Nie"),
  compute_number(question = qn_11, response = "Tak"),
  compute_number(question = qn_11, response = "Tak", conditional = TRUE, question2 = science_label, response2 = "Nauki Humanistyczne"),
  compute_number(question = qn_11, response = "Tak", conditional = TRUE, question2 = science_label, response2 = "Nauki Ścisłe i Przyrodnicze"),
  compute_number(question = qn_11, response = "Tak", conditional = TRUE, question2 = science_label, response2 = "Nauki Społeczne")
  )
```

**`r question_show(question = "qn_11")`**

```{r obrona-plan-2,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_11,
                   conditional = TRUE,
                   question2 = qn_39,
                   COLORS = COLORS[2:1],
                   legend = TRUE,
                   legend_title = question_show(question = "qn_39"))
cap <- sprintf(
  "Z %i doktorantek i doktorantów kształcących się w szkołach doktorskich, połowa (%i) spodziewa się, że w związku z ogłoszoną decyzją o wprowadzeniu zdalnego nauczania na Uniwersytecie Warszawskim do 15 maja 2020 oraz szeregiem ograniczeń w tym semestrze, będzie miała problem z przygotowaniem Indywidualnego Planu Badawczego. Większość (%i!) z tych, dla których będzie to problem, równocześnie nie może prowadzić badań do doktoratu. W przypadku osób, które nie obawiają się wpływu pandemii na przygotowanie Indywidualnego Planu Badawczego, nie może realizować badań %i osób.",
  compute_number(question = qn_11, response = "Tak") + compute_number(question = qn_11, response = "Nie"),
  compute_number(question = qn_11, response = "Tak"),
  compute_number(question = qn_11, response = "Tak", conditional = TRUE, question2 = qn_39, response2 = "Tak"),
  compute_number(question = qn_11, response = "Nie", conditional = TRUE, question2 = qn_39, response2 = "Tak")
  )
```

**`r question_show(question = "qn_11")`**

```{r obrona-plan-3,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_11,
                   conditional = TRUE,
                   question2 = scale,
                   COLORS = COLORS[2:1],
                   legend = TRUE,
                   legend_title = "Na ile zmienił się Twój kontakt z Promotorem / Promotorką?")
cap <- sprintf(
  "Z %i doktorantek i doktorantów kształcących się w szkołach doktorskich, połowa (%i) spodziewa się, że w związku z ogłoszoną decyzją o wprowadzeniu zdalnego nauczania na Uniwersytecie Warszawskim do 15 maja 2020 oraz szeregiem ograniczeń w tym semestrze, będzie miała problem z przygotowaniem Indywidualnego Planu Badawczego. Prawie połowa (%i) doktorantek i doktorantów, którzy będą mieć ten problem, jednocześnie uważa, ze ich kontakt z Promotorem / Promotorką się pogorszył. Wśród tych, którzy nie obawiają się, że będą mieć problem z przygotowaniem Indywidualnego Planu Badawczego tylko %i osób uważa, że ich kontakt się pogorszył.",
  compute_number(question = qn_11, response = "Tak") + compute_number(question = qn_11, response = "Nie"),
  compute_number(question = qn_11, response = "Tak"),
  compute_number(question = qn_11, response = "Tak", conditional = TRUE, question2 = scale, response2 = "Jest gorzej"),
  compute_number(question = qn_11, response = "Nie", conditional = TRUE, question2 = scale, response2 = "Jest gorzej")
  )
```

**`r question_show(question = "qn_11")`**

```{r obrona-plan-4,  layout="l-body-outset", fig.cap=cap}
cap <- sprintf(
  "Z %i doktorantek i doktorantów kształcących się w szkołach doktorskich, połowa (%i) spodziewa się, że w związku z ogłoszoną decyzją o wprowadzeniu zdalnego nauczania na Uniwersytecie Warszawskim do 15 maja 2020 oraz szeregiem ograniczeń w tym semestrze, będzie miała problem z przygotowaniem Indywidualnego Planu Badawczego. Prawie połowa (%i) doktorantek i doktorantów, którzy będą mieć ten problem, jednocześnie obawia się, że będzie mieć problem z terminową realizacją kształcenia w szkole doktorskiej.",
  compute_number(question = qn_11, response = "Tak") + compute_number(question = qn_11, response = "Nie"),
  compute_number(question = qn_11, response = "Tak"),
  compute_number(question = qn_11, response = "Tak", conditional = TRUE, question2 = qn_44, response2 = "Tak"))

plot_con_questions(question = qn_11,
                   conditional = TRUE,
                   question2 = qn_44,
                   legend_title = question_show(question = "qn_44"),
                   COLOR = COLORS[2:1],
                   ymin = 300,
                   ymax = 330)
```

## Tabele

```{r obrona-plan-table-4,  layout="l-body-outset"}
cap <- sprintf(
  "Z %i doktorantek i doktorantów kształcących się w szkołach doktorskich, ponad połowa (%i) spodziewa się, że w związku z ogłoszoną decyzją o wprowadzeniu zdalnego nauczania na Uniwersytecie Warszawskim do 15 maja 2020 oraz szeregiem ograniczeń w tym semestrze, będzie miała problem z przygotowaniem Indywidualnego Planu Badawczego. Prawie połowa (%i) doktorantek i doktorantów, którzy będą mieć ten problem jednocześnie obawia się, że będzie mieć problem z terminową realizacją kształcenia w szkole doktorskiej (Mikołaj: w sumie wszyscy powinni się obawiać, bo przecież przygotowanie IPB jest częścią terminowej realizacji kształcenia).",
  compute_number(question = qn_11, response = "Tak") + compute_number(question = qn_11, response = "Nie"),
  compute_number(question = qn_11, response = "Tak"),
  compute_number(question = qn_11, response = "Tak", conditional = TRUE, question2 = qn_44, response2 = "Tak"))

make_table(question = qn_11,
           conditional = TRUE,
           question2 = qn_44,
           cap = cap)
```

```{r obrona-plan-table,  layout="l-body-outset"}
cap <- sprintf(
  "Z %i doktorantek i doktorantów kształcących się w szkołach doktorskich, ponad połowa (%i) spodziewa się, że w związku z ogłoszoną decyzją o wprowadzeniu zdalnego nauczania na Uniwersytecie Warszawskim do 15 maja 2020 oraz szeregiem ograniczeń w tym semestrze, będzie miała problem z przygotowaniem Indywidualnego Planu Badawczego. Najwięcej takich doktorantek i doktorantów reprezentuje Nauki Humanistyczne - %i, Nauki Ścisłe i Przyrodnicze - %i, a Nauki Społeczne - %i (u jednej osoby ciężko było zidentyfikować dziedzinę nauki).",
  compute_number(question = qn_11, response = "Tak") + compute_number(question = qn_11, response = "Nie"),
  compute_number(question = qn_11, response = "Tak"),
  compute_number(question = qn_11, response = "Tak", conditional = TRUE, question2 = science_label, response2 = "Nauki Humanistyczne"),
  compute_number(question = qn_11, response = "Tak", conditional = TRUE, question2 = science_label, response2 = "Nauki Ścisłe i Przyrodnicze"),
  compute_number(question = qn_11, response = "Tak", conditional = TRUE, question2 = science_label, response2 = "Nauki Społeczne")
  )

```


```{r obrona-plan-table-2,  layout="l-body-outset"}
cap <- sprintf(
  "Z %i doktorantek i doktorantów kształcących się w szkołach doktorskich, połowa (%i) spodziewa się, że w związku z ogłoszoną decyzją o wprowadzeniu zdalnego nauczania na Uniwersytecie Warszawskim do 15 maja 2020 oraz szeregiem ograniczeń w tym semestrze, będzie miała problem z przygotowaniem Indywidualnego Planu Badawczego. Większość (%i!) z tych, dla których będzie to problem, równocześnie nie może prowadzić badań do doktoratu. W przypadku osób, które nie obawiają się wpływu pandemii na przygotowanie Indywidualnego Planu Badawczego, nie może realizować badań %i osób.",
  compute_number(question = qn_11, response = "Tak") + compute_number(question = qn_11, response = "Nie"),
  compute_number(question = qn_11, response = "Tak"),
  compute_number(question = qn_11, response = "Tak", conditional = TRUE, question2 = qn_39, response2 = "Tak"),
  compute_number(question = qn_11, response = "Nie", conditional = TRUE, question2 = qn_39, response2 = "Tak")
  )

make_table(question = qn_11,
           conditional = TRUE,
           question2 = qn_39,
           cap = cap)
```

```{r obrona-plan-table-3,  layout="l-body-outset"}
cap <- sprintf(
  "Z %i doktorantek i doktorantów kształcących się w szkołach doktorskich, połowa (%i) spodziewa się, że w związku z ogłoszoną decyzją o wprowadzeniu zdalnego nauczania na Uniwersytecie Warszawskim do 15 maja 2020 oraz szeregiem ograniczeń w tym semestrze, będzie miała problem z przygotowaniem Indywidualnego Planu Badawczego. Prawie połowa (%i) doktorantek i doktorantów, którzy będą mieć ten problem jednocześnie uważa, ze ich kontakt z Promotorem / Promotorką się pogorszył. Wśród tych, którzy nie obawiają się, że będą mieć problem z przygotowaniem Indywidualnego Planu Badawczego tylko %i osób uważa, że ich kontakt się pogorszył.",
  compute_number(question = qn_11, response = "Tak") + compute_number(question = qn_11, response = "Nie"),
  compute_number(question = qn_11, response = "Tak"),
  compute_number(question = qn_11, response = "Tak", conditional = TRUE, question2 = scale, response2 = "Jest gorzej"),
  compute_number(question = qn_11, response = "Nie", conditional = TRUE, question2 = scale, response2 = "Jest gorzej")
  )

data_wide %>%
  filter(!is.na(qn_11)) %>%
  filter(scale != "") %>%
  group_by(qn_11, scale) %>%
  summarise(Liczebność = n()) %>%
  arrange(desc(Liczebność)) %>%
  rename("Na ile zmienił się Twój kontakt z Promotorem / Promotorką?" = scale,
         !!question_show(question = "qn_11") := qn_11) %>%
   kable(caption = cap, "html") %>%
      kable_styling(bootstrap_options = c("striped","hover"),
                    font_size = 10,
                    full_width = TRUE)
```

## Otwarte

```{r qn12-table, layout="l-body-outset"}
make_open_table(question = qn_12,
                defualt_cap = FALSE,
                custom_cap = "Jeśli odpowiedziałaś / odpowiedziałeś ,,Tak'' w pytaniu dotyczącym problemów z przygotowaniem planu badawczego, to napisz na czym polega ten problem i co Uniwersytet Warszawski może zrobić, żeby pomóc Ci go rozwiązać?")
```

```{r table-qn44-ipb}
temp_table <- data_wide %>%
  filter(!is.na(qn_11))
make_open_table(table = temp_table,
                question = qn_40,
                defualt_cap = FALSE,
                custom_cap = "Jeśli odpowiedziałaś / odpowiedziałeś ,,Tak'' w pytaniu dotyczącym wpływu ograniczeń na realizowane przez Ciebie badania, to napisz na czym polega ten problem i co Uniwersytet Warszawski może zrobić, żeby pomóc Ci go rozwiązać?")
```

```{r table-qn45-ipb}
temp_table <- data_wide %>%
  filter(!is.na(qn_9))
make_open_table(table = temp_table,
                question = qn_45,
                defualt_cap = FALSE,
                custom_cap = "Jeśli odpowiedziałaś / odpowiedziałeś ,,Tak'' w pytaniu dotyczącym wpływu ograniczeń na Twoją możliwość terminowej realizacji kształcenia w szkole doktorskiej, to napisz na czym polega ten problem i co Uniwersytet Warszawski może zrobić, żeby pomóc Ci go rozwiązać?")
```

# Nauczanie {.tabset}

## Wykresy

**`r question_show(question = "qn_14")`**

```{r zajecia-zdalne,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_14,
                   conditional = TRUE,
                   question2 = qn_17,
                   legend_title = question_show(question = "qn_17"),
                   ymin = 160,
                   ymax = 190,
                   COLORS = COLORS[2:1])

cap <- sprintf(
  "Z %i doktorantek i doktorantów prowadzących zajęcia zdecydowana większość (%i) prowadzi zajęcia zdalnie. Jednak warto zwrócić uwagę na to, że aż %i z %i doktorantek i doktorantów nieprowadzących zajęć nie ma warunków do prowadzenia zajęć zdalnych.",
  compute_number(question = qn_14, response = "Tak") + compute_number(question = qn_14, response = "Nie"),
  compute_number(question = qn_14, response = "Tak"),
  compute_number(question = qn_14, response = "Nie", conditional = TRUE, question2 = qn_17, response2 = "Tak"),
  compute_number(question = qn_14, response = "Nie"))
```

**`r question_show(question = "qn_14")`**

```{r zajecia-zdalne-pomoc,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_14,
                   conditional = TRUE,
                   question2 = qn_15,
                   legend_title = question_show(question = "qn_15"),
                   COLORS = COLORS[2:1],
                   ymin = 160,
                   ymax = 190)
cap <- sprintf(
  "Ze %i doktorantek i doktorantów prowadzących zajęcia zdalne %i dodatkowo pomaga prowadzić zajęcia zdalne, wśród tych którzy nie prowadzą zajęć zdalnych pomaga %i.",
  compute_number(question = qn_14, response = "Tak"),
  compute_number(question = qn_14, response = "Tak", conditional = TRUE, question2 = qn_15, response2 = "Tak"),
  compute_number(question = qn_14, response = "Nie", conditional = TRUE, question2 = qn_15, response2 = "Tak"))
```

**`r question_show(question = "qn_14")`**

```{r zajecia-zdalne-kurs,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_14,
                   conditional = TRUE,
                   question2 = qn_20,
                   legend_title = question_show(question = "qn_20"),
                   COLORS = COLORS[2:1],
                   ymin = 160,
                   ymax = 190)
cap <- sprintf("Ze %i doktorantek i doktorantów prowadzących zajęcia zdalne %i jest zainteresowanych uczestnictwem w kursie doskonalącym umiejętności nauczania zdalnego, spośród tych którzy nie prowadzą zajęć zdalnych zainteresowanych jest %i.",
               compute_number(question = qn_14, response = "Tak"),
               compute_number(question = qn_14, response = "Tak", conditional = TRUE, question2 = qn_20, response2 = "Tak"),
               compute_number(question = qn_14, response = "Nie", conditional = TRUE, question2 = qn_20, response2 = "Tak"))
```

## Tabele

```{r zajecia-zdalne-table,  layout="l-body-outset"}
cap <- sprintf(
  "Z %i doktorantek i doktorantów prowadzących zajęcia zdecydowana większość (%i) prowadzi zajęcia zdalnie. Jednak warto zwrócić uwagę na to, że aż %i  z %i doktorantek i doktorantów nieprowadzących zajęć nie ma warunków do prowadzenia zajęć zdalnych.",
  compute_number(question = qn_14, response = "Tak") + compute_number(question = qn_14, response = "Nie"),
  compute_number(question = qn_14, response = "Tak"),
  compute_number(question = qn_14, response = "Nie", conditional = TRUE, question2 = qn_17, response2 = "Tak"),
  compute_number(question = qn_14, response = "Nie"))

make_table(question = qn_14,
           conditional = TRUE,
           question2 = qn_17,
           cap = cap)
```

```{r zajecia-zdalne-pomoc-table,  layout="l-body-outset"}
cap <- sprintf(
  "Z %i doktorantek i doktorantów, pomagających prowadzić zajęcia zdalne %i dodatkowo pomaga prowadzić zajęcia zdalne, wśród tych którzy nie prowadzą zajęć zdalnych pomaga %i.",
  compute_number(question = qn_14, response = "Tak"),
  compute_number(question = qn_14, response = "Tak", conditional = TRUE, question2 = qn_15, response2 = "Tak"),
  compute_number(question = qn_14, response = "Nie", conditional = TRUE, question2 = qn_15, response2 = "Tak"))

make_table(question = qn_14,
           conditional = TRUE,
           question2 = qn_15,
           cap = cap)
```

```{r zajecia-zdalne-kurs-table,  layout="l-body-outset"}
cap <- sprintf("Z %i doktorantek i doktorantów prowadzących zajęcia zdalne %i jest zainteresowanych uczestnictwem w kursie doskonalącym umiejętności nauczania zdalnego, spośród tych którzy nie prowadzą zajęć zdalnych zainteresowanych jest %i.",
               compute_number(question = qn_14, response = "Tak"),
               compute_number(question = qn_14, response = "Tak", conditional = TRUE, question2 = qn_20, response2 = "Tak"),
               compute_number(question = qn_14, response = "Nie", conditional = TRUE, question2 = qn_20, response2 = "Tak"))

make_table(question = qn_14,
           conditional = TRUE,
           question2 = qn_20,
           cap = cap)
```

## Otwarte

```{r qn18-table, layout="l-body-outset"}
make_open_table(question = qn_18)
```

```{r qn19-table, layout="l-body-outset"}
make_open_table(question = qn_19)
```

# Zajęcia {.tabset}

## Wykresy

**`r question_show(question = "qn_22")`**

```{r uczestnictwo-zdalne,  layout="l-body-outset", fig.cap=cap}
cap <- sprintf(
  "Aż %i doktorantów i doktorantek deklaruje, że wszystkie ich zajęcia odbywają się zdalnie. Jednak z drugiej strony aż dla %i ani jedne zajęcia nie odbywają się w trybie zdalnym. Co zaskakujące najwięcej osób (%i), które zadeklarowały, że żadne ich zajęcia nie odbywają się zdalnie, jest związanych z Naukami Humanistycznymi.",
  compute_number(question = qn_22, response = "Wszystkie"),
  compute_number(question = qn_22, response = "Ani jedne"),
  compute_number(question = qn_22, response = "Ani jedne", conditional = TRUE, question2 = science_label, response2 = "Nauki Humanistyczne"))

order_qn22 <- data_wide %>%
  filter(!is.na(qn_22) & science_label != "") %>%
  group_by(qn_22) %>%
  summarise(count = n()) %>%
  arrange(count) %$%
  qn_22

data_wide %>%
  filter(!is.na(qn_22) & science_label != "") %>%
  mutate(label = factor(qn_22, levels = order_qn22),
         science_label = factor(science_label, levels = c("Nauki Humanistyczne", "Nauki Społeczne", "Nauki Ścisłe i Przyrodnicze"))) %>%
  ggplot(aes(x = label, fill = science_label)) +
  geom_bar() +
  theme_classic() +
  labs(x = "", y = "Liczebność")+ 
  #annotation_custom(l, xmin = -1, xmax = 2.2, ymin = 112, ymax = 137) + 
  #coord_cartesian(clip = "off") +
  coord_flip() +
  scale_y_continuous(expand = expansion(mult = c(0, .1))) +
  scale_fill_manual(values=COLORS, limits = c("Nauki Humanistyczne", "Nauki Społeczne", "Nauki Ścisłe i Przyrodnicze")) +
  theme(legend.position="bottom", legend.title = element_blank())
```

**`r question_show(question = "qn_23")`**

```{r zajecia-zdalne-kurs-2,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_23,
                   conditional = TRUE,
                   question2 = qn_23,
                   legend_title = "",
                   COLORS = COLORS[2:1],
                   ymin = 160,
                   ymax = 190)
cap <- sprintf("Z %i doktorantek i doktorantów, którzy uczestniczą w tym semestrze w zajęciach, %i ma warunki do uczestniczenia w zajęciach zdalnych.",
               compute_number(question = qn_23, response = "Tak") + compute_number(question = qn_23, response = "Nie"),
               compute_number(question = qn_23, response = "Tak"))
```

## Otwarte

```{r qn25-table, layout="l-body-outset"}
make_open_table(question = qn_25)
```

```{r qn26-table, layout="l-body-outset"}
make_open_table(question = qn_26)
```

```{r table-good-examples, layout="l-body-outset"}
cap = question_show(question = "qn_24")
data_wide %>%
  filter(!is.na(qn_24)) %>%
  filter(nchar(qn_24) > 10) %>%
  filter(!qn_24 %in% c("Żadne zajęcia",
                       "Nie dotyczy",
                       "póki co wszystko jest w stadium organizacji",
                       "Żadne się do tego nie nadają",
                       "Żadne, na które jestem zapisana.",
                       "Jedynie wykłady mają sens być prowadzone zdalnie.",
                       "nie dotyczy - moje zajęcia, w których jestem uczestniczką nie odbywają się zdalnie",
                       "nd, brak zajęć zdalnych na moich studiach",
                       "Zajęcia na wydziale nie są prowadzone zdalnie. Przesłanie prezentacji, pełnej błędów, klejonej na szybko przez prof szatur jaworską uważam za kompletne nieporozumienie. Osoba prowadząca drugi przedmiot prof. Stanisław Bieleń, jak dotychczas nie nawiązał jakiejkolwiek interakcji z doktorantami,",
                       "To są oguny",
                       "Żadne, uważam, że przesyłanie prezentacji to nie jest prowadzenie zajęć online.",
                       "pierwsze spotkanie dopiero się odbędzie",
                       "Będę miała pierwsze w końcu kwietnia, zatem nie mogę odpowiedzieć na to pytanie",
                       "Nie mam zdania.",
                       "Nie mogę ocenić",
                       "Żadne (ale jedne jeszcze się nie odbyły)",
                       "Jeszcze się nie odbyły :)",
                       "Brak takich zajęć")) %>%
  select(Jednostka =  faculty_label,
         position,
         Odpowiedź = qn_24) %>%
  ungroup() %>%
  mutate(id = 1:n(),
         Jednostka = as.factor(Jednostka),
         position = as.factor(position)) %>%
  rename("Rodzaj kształcenia" = position) %>%
  DT::datatable(caption = cap,
                rownames = FALSE,
                filter = "top",
                options = list(sDom  = '<"top">lrt<"bottom">ip'))

```

# Administracja {.tabset}

## Wykresy

**`r question_show(question = "qn_27")`**

```{r admin-info,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_27,
                   conditional = TRUE,
                   question2 = position,
                   COLOR = COLORS[2:1],
                   ymin = 450,
                   ymax = 510)
cap <- sprintf(
  "Z %i doktorantek i doktorantów, którzy wzięli udział w ankiecie, aż %i dostaje informacje na temat zmian w funkcjonowaniu Uniwersytetu Warszawskiego od swojej jednostki.",
  compute_number(question = qn_27, response = "Tak") + compute_number(question = qn_27, response = "Nie"),
  compute_number(question = qn_27, response = "Tak"))
```

**`r question_show(question = "qn_28")`**

```{r admin-jednostka,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_28,
                   conditional = TRUE,
                   question2 = position,
                   COLOR = COLORS[2:1],
                   ymin = 240,
                   ymax = 270)
cap <- sprintf(
  "Z %i doktorantek i doktorantów tylko %i ocenia pracę administracji w swojej jednostce w sposób negatywny.",
  compute_number(question = qn_28, response = "Tak") + compute_number(question = qn_28, response = "Nie") + compute_number(question = qn_28, response = "Brak kontaktu"),
  compute_number(question = qn_28, response = "Nie"))
```

**`r question_show(question = "qn_29")`**

```{r admin-uw,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_29,
                   conditional = TRUE,
                   question2 = position,
                   COLOR = COLORS[2:1])
cap <- sprintf(
  "Z %.0f doktorantek i doktorantów tylko %.0f ocenia pracę administracji uniwersyteckiej w sposób negatywny.",
  compute_number(question = qn_29, response = "Tak") + compute_number(question = qn_29, response = "Nie") + compute_number(question = qn_29, response = "Brak kontaktu"),
  compute_number(question = qn_29, response = "Nie"))
```

**`r question_show(question = "qn_31")`**

```{r sources,  layout="l-body-outset", fig.cap=cap}
data_temp <- data_wide %>%
  mutate(qn_31 = str_split(qn_31, pattern = ",")) %>% 
  unnest(qn_31) %>%
  mutate(qn_31 = trimws(qn_31)) %>% 
  ungroup(id) %>%
  left_join(source_map)

cap <- sprintf("Najczęstszym deklarowanym źródłem informacji jest jednostka, aż %i doktorantów i doktorantek dostaje informacje z tego źródła. Potem jest Lista Mailingowa itd. Najsmutniejsze jest to, że Strona Samorządu UW przegrywa %i do %i z Monitorem UW.", compute_number(table = data_temp, question = source_label, response = "Z jednostki"), compute_number(table = data_temp, question = source_label, response = "Ze strony SD UW"), compute_number(table = data_temp, question = source_label, response = "Z Monitora UW"))

order_sources <- data_temp %>%
  filter(!is.na(source_label)) %>%
  group_by(source_label) %>%
  summarise(count = n()) %>%
  arrange(count) %$%
  source_label

data_temp %>%
  filter(!is.na(source_label)) %>%
  mutate(label = factor(source_label, levels = order_sources),
         position = factor(position, levels = c("Szkoła Doktorska", "Studia Doktoranckie" ))) %>%
  ggplot(aes(x = label, fill = position)) +
  geom_bar() +
  theme_classic() +
  labs(title = "", x = "", y = "Liczebność")+ 
  #annotation_custom(l, xmin = -1, xmax = 4, ymin = 45, ymax = 60) + 
  #coord_cartesian(clip = "off") +
  coord_flip() +
  scale_y_continuous(expand = expansion(mult = c(0, .1))) +
  scale_fill_manual(values=COLORS[1:2], limits = c("Studia Doktoranckie", "Szkoła Doktorska")) +
  theme(legend.position="bottom", legend.title = element_blank())
```

**`r question_show(question = "qn_30")`**

```{r admin-spotkanie,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_30,
                   conditional = TRUE,
                   question2 = position,
                   COLOR = COLORS[2:1],
                   ymin = 450,
                   ymax = 510)
cap <- sprintf(
  "W spotkaniu z Panią Rektor prof. dr hab. Jolantą Choińską - Miką wzięło udział jedynie %i z %i osób, które wypełniły ankietę. Wydaje się, że w przyszłości najlepszymi sposobami dotarcia do doktorantek i doktorantów z informacją na temat podobnego spotkania byłoby wysłanie zaproszenia przez Listę Mailingową oraz przez jednostki.",
  compute_number(question = qn_30, response = "Tak"),
  compute_number(question = qn_30, response = "Tak") + compute_number(question = qn_30, response = "Nie"))
```

## Tabele

```{r admin-info-table,  layout="l-body-outset"}
cap <- sprintf(
  "Z %i doktorantek i doktorantów, którzy wzięli udział w ankiecie aż %i dostaje informacje na temat zmian w funkcjonowaniu Uniwersytetu Warszawskiego od swojej jednostki.",
  compute_number(question = qn_27, response = "Tak") + compute_number(question = qn_27, response = "Nie"),
  compute_number(question = qn_27, response = "Tak"))


data_wide %>%
  filter(!is.na(qn_27)) %>%
  filter(scale != "") %>%
  group_by(qn_27, position) %>%
  summarise(Liczebność = n()) %>%
  arrange(desc(Liczebność)) %>%
  rename("Rodzaj kształcenia" = position,
         !!question_show(question = "qn_27") := qn_27) %>%
   kable(caption = cap, "html") %>%
      kable_styling(bootstrap_options = c("striped","hover"),
                    font_size = 10,
                    full_width = TRUE)
```

```{r admin-jednostka-table,  layout="l-body-outset"}
cap <- sprintf(
  "Z %i doktorantek i doktorantów tylko %i ocenia pracę administracji w swojej jednostce w sposób negatywny.",
  compute_number(question = qn_28, response = "Tak") + compute_number(question = qn_28, response = "Nie") + compute_number(question = qn_28, response = "Brak kontaktu"),
  compute_number(question = qn_28, response = "Nie"))

data_wide %>%
  filter(!is.na(qn_28)) %>%
  filter(scale != "") %>%
  group_by(qn_28, position) %>%
  summarise(Liczebność = n()) %>%
  arrange(desc(Liczebność)) %>%
  rename("Rodzaj kształcenia" = position,
         !!question_show(question = "qn_28") := qn_28) %>%
   kable(caption = cap, "html") %>%
      kable_styling(bootstrap_options = c("striped","hover"),
                    font_size = 10,
                    full_width = TRUE)
```

**`r question_show(question = "qn_29")`**

```{r admin-uw-table,  layout="l-body-outset"}
cap <- sprintf(
  "Z %.0f doktorantek i doktorantów tylko %.0f ocenia pracę administracji uniwersyteckiej w sposób negatywny.",
  compute_number(question = qn_29, response = "Tak") + compute_number(question = qn_29, response = "Nie") + compute_number(question = qn_29, response = "Brak kontaktu"),
  compute_number(question = qn_29, response = "Nie"))

data_wide %>%
  filter(!is.na(qn_29)) %>%
  filter(scale != "") %>%
  group_by(qn_29, position) %>%
  summarise(Liczebność = n()) %>%
  arrange(desc(Liczebność)) %>%
  rename("Rodzaj kształcenia" = position,
         !!question_show(question = "qn_29") := qn_29) %>%
   kable(caption = cap, "html") %>%
      kable_styling(bootstrap_options = c("striped","hover"),
                    font_size = 10,
                    full_width = TRUE)
```

```{r sources-table,  layout="l-body-outset"}
data_temp <- data_wide %>%
  mutate(qn_31 = str_split(qn_31, pattern = ",")) %>% 
  unnest(qn_31) %>%
  mutate(qn_31 = trimws(qn_31)) %>% 
  ungroup(id) %>%
  left_join(source_map)

cap <- sprintf("Najczęstszym deklarowanym źródłem informacji jest jednostka, aż %i doktorantów i doktorantek dostaje informacje z tego źródła. Potem jest Lista Mailingowa itd. Najsmutniejsze jest to, że Strona Samorządu UW przegrywa %i do %i z Monitorem UW.", compute_number(table = data_temp, question = source_label, response = "Z jednostki"), compute_number(table = data_temp, question = source_label, response = "Ze strony SD UW"), compute_number(table = data_temp, question = source_label, response = "Z Monitora UW"))

order_sources <- data_temp %>%
  filter(!is.na(source_label)) %>%
  group_by(source_label) %>%
  summarise(count = n()) %>%
  arrange(count) %$%
  source_label

data_temp %>%
  filter(!is.na(source_label)) %>%
  mutate(label = factor(source_label, levels = order_sources),
         position = factor(position, levels = c("Szkoła Doktorska", "Studia Doktoranckie" ))) %>%
  filter(!is.na(label)) %>%
  filter(scale != "") %>%
  group_by(label, position) %>%
  summarise(Liczebność = n()) %>%
  arrange(desc(Liczebność)) %>%
  rename("Rodzaj kształcenia" = position,
         !! question_show(question = "qn_31") := label) %>%
   kable(caption = cap, "html") %>%
      kable_styling(bootstrap_options = c("striped","hover"),
                    font_size = 10,
                    full_width = TRUE)
```

```{r admin-spotkanie-table,  layout="l-body-outset"}
cap <- sprintf(
  "W spotkaniu z Panią Rektor prof. dr hab. Jolantą Choińską - Miką wzięło udział jedynie %i z %i osób, które wypełniły ankietę.",
  compute_number(question = qn_30, response = "Tak"),
  compute_number(question = qn_30, response = "Tak") + compute_number(question = qn_30, response = "Nie"))

data_wide %>%
  filter(!is.na(qn_30)) %>%
  filter(scale != "") %>%
  group_by(qn_30, position) %>%
  summarise(Liczebność = n()) %>%
  arrange(desc(Liczebność)) %>%
  rename("Rodzaj kształcenia" = position,
         !!question_show(question = "qn_30") := qn_30) %>%
   kable(caption = cap, "html") %>%
      kable_styling(bootstrap_options = c("striped","hover"),
                    font_size = 10,
                    full_width = TRUE)
```

## Otwarte 

```{r qn32-table, layout="l-body-outset"}
make_open_table(question = qn_32)
```

```{r qn33-table, layout="l-body-outset"}
make_open_table(question = qn_33)
```

# Sytuacja Socjalna {.tabset}

## Wykresy

**`r question_show(question = "qn_34")`**

```{r social-dochod,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_34,
                   conditional = TRUE,
                   question2 = qn_36,
                   legend_title = question_show(question = "qn_36"),
                   COLOR = COLORS[2:1])
cap <- sprintf("Z %i doktorantek i doktorantów aż %i utraciło źródło dochodu w związku z wprowadzonymi przez Rząd restrykcjami. Jednocześnie aż %i doktorantów i doktorantek obawia się, że będzie musiała zrezygnować z pisania doktoratu z powodu trudnej sytuacji finansowej, bez względu na to czy utracili dochód czy nie.",
               compute_number(question = qn_34, response = "Tak") + compute_number(question = qn_34, response = "Nie"),
               compute_number(question = qn_34, response = "Tak"),
               compute_number(question = qn_36, response = "Tak"))
```

**`r question_show(question = "qn_34")`**

```{r social-zapomoga,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_34,
                   conditional = TRUE,
                   question2 = qn_35,
                   legend_title = question_show(question = "qn_35"),
                   COLOR = COLORS[2:1])
cap <- sprintf("Z %i doktorantek i doktorantów aż %i utraciło źródło dochodu w związku z wprowadzonymi przez Rząd restrykcjami. Jednocześnie mniej niż połowa (%i) z nich wie jak uzyskać zapomogę.",
               compute_number(question = qn_34, response = "Tak") + compute_number(question = qn_34, response = "Nie"),
               compute_number(question = qn_34, response = "Tak"),
               compute_number(question = qn_34, response = "Tak", conditional = TRUE, question2 = qn_35, response2 = "Tak"))
```

**`r question_show(question = "qn_36")`**

```{r social-doktorat,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_36,
                   conditional = TRUE,
                   question2 = qn_35,
                   legend_title = question_show(question = "qn_35"),
                   COLOR = COLORS[2:1])
cap <- sprintf("Z %i doktorantek i doktorantów aż %i obawia się, że będzie musiała zrezygnować z doktoratu z powodu trudnej sytuacji finansowej. Jednocześnie tylko %i z nich wie jak uzyskać zapomogę.",
               compute_number(question = qn_36, response = "Tak") + compute_number(question = qn_36, response = "Nie"),
               compute_number(question = qn_36, response = "Tak"),
               compute_number(question = qn_36, response = "Tak", conditional = TRUE, question2 = qn_35, response2 = "Tak"))
```

## Tabele

```{r social-dochod-table,  layout="l-body-outset"}
cap <- sprintf("Z %i doktorantek i doktorantów aż %i utraciło źródło dochodu w związku z wprowadzonymi przez Rząd restrykcjami. Jednocześnie aż %i doktorantów i doktorantek obawia się, że będzie musiała zrezygnować z pisania doktoratu z powodu trudnej sytuacji finansowej, bez względu na to czy utracili dochód czy nie.",
               compute_number(question = qn_34, response = "Tak") + compute_number(question = qn_34, response = "Nie"),
               compute_number(question = qn_34, response = "Tak"),
               compute_number(question = qn_36, response = "Tak"))

make_table(question = qn_34,
           conditional = TRUE,
           question2 = qn_36,
           cap = cap)
```

```{r social-zapomoga-table,  layout="l-body-outset"}
cap <- sprintf("Z %i doktorantek i doktorantów aż %i utraciło źródło dochodu w związku z wprowadzonymi przez Rząd restrykcjami. Jednocześnie mniej niż połowa (%i) z nich wie jak uzyskać zapomogę.",
               compute_number(question = qn_34, response = "Tak") + compute_number(question = qn_34, response = "Nie"),
               compute_number(question = qn_34, response = "Tak"),
               compute_number(question = qn_34, response = "Tak", conditional = TRUE, question2 = qn_35, response2 = "Tak"))

make_table(question = qn_34,
           conditional = TRUE,
           question2 = qn_36,
           cap = cap)
```

```{r social-doktorat-table,  layout="l-body-outset"}
cap <- sprintf("Z %i doktorantek i doktorantów aż %i obawia się, że będzie musiała zrezygnować z doktoratu z powodu trudnej sytuacji finansowej. Jednocześnie tylko %i z nich wie jak uzyskać zapomogę.",
               compute_number(question = qn_36, response = "Tak") + compute_number(question = qn_36, response = "Nie"),
               compute_number(question = qn_36, response = "Tak"),
               compute_number(question = qn_36, response = "Tak", conditional = TRUE, question2 = qn_35, response2 = "Tak"))

make_table(question = qn_34,
           conditional = TRUE,
           question2 = qn_35,
           cap = cap)
```

# Promotorzy {.tabset}

## Wykresy

**Na ile zmienił się Twój kontakt z Promotorką / Promotorem (Opiekunem / Opiekunką naukową) podczas pandemii?**

```{r promo,  layout="l-body-outset", fig.cap=cap}
cap <- sprintf(
  "Dla przeważającej większości (%i) doktorantek i doktorantów kontakt z Promotorką / Promotorem (Opiekunem / Opiekunką naukową) mimo szeregu ograniczeń w funkcjonowaniu Uniwersytetu Warszawskiego pozostał bez zmian lub się polepszył. Jednak dla aż %i obecna sytuacja wpłynęła na pogorszenie się tego kontaktu.",
  compute_number(question = qn_37, response = 3) + compute_number(question = qn_37, response = 5) + compute_number(question = qn_37, response = 4),
  compute_number(question = qn_37, response = 1) + compute_number(question = qn_37, response = 2))

plot_con_questions(question = scale,
                   conditional = TRUE,
                   question2 = position,
                   legend_title = "",
                   COLOR = COLORS[2:1],
                   ymin = 300,
                   ymax = 330)
```

**Kiedy ostatnio rozmawiałaś / rozmawiałeś (przez telefon lub wykorzystując dostępne narzędzia informatyczne) ze swoją Promotorką / Promotorem (Opiekunem / Opiekunką naukową)?**

```{r promo-call,  layout="l-body-outset", fig.cap=cap}
cap <- sprintf("Większość (%i) doktorantek i doktorantów rozmawiała ze swoją Promotorką / Promotorem (Opiekunką / Opiekunem naukowym) w ciągu ostatnich dwóch tygodni. Jednakże jest też spora grupa %i doktorantek i doktorantów, która od ponad dwóch tygodni nie miała kontaktu ze swoją Promotorką / Promotorem (Opiekunką / Opiekunem naukowym). Co mało zaskakujące spora część z nich uważa, że ich kontakt się pogorszył (%i)",
               compute_number(question = contact_label, response = "W ciągu ostatnich\n 2 tygodnii"),
               compute_number(question = contact_label, response = "Nie rozmawialiśmy /\nrozmawiałyśmy \nod 2 tygodni"),
               compute_number(question = contact_label, response = "Nie rozmawialiśmy /\nrozmawiałyśmy \nod 2 tygodni", conditional = TRUE, question2 = scale, response2 = "Jest gorzej"))

plot_con_questions(question = contact_label,
                   conditional = TRUE,
                   question2 = scale,
                   legend_title = "Na ile zmienił się Twój kontakt z Promotorką / Promotorem (Opiekunem / Opiekunką naukową) podczas pandemii?",
                   reorder = TRUE,
                   COLOR = COLORS[2:1],
                   ymin = 150,
                   ymax = 180)
```

## Tabele

```{r promo-table,  layout="l-body-outset"}
cap <- sprintf(
  "Dla przeważającej większości (%i) doktorantek i doktorantów kontakt z Promotorką / Promotorem (Opiekunem / Opiekunką naukową) mimo szeregu ograniczeń w funkcjonowaniu Uniwersytetu Warszawskiego pozostał bez zmian lub się polepszył. Jednak dla aż %i obecna sytuacja wpłynęła na pogorszenie się tego kontaktu.",
  compute_number(question = qn_37, response = 3) + compute_number(question = qn_37, response = 5) + compute_number(question = qn_37, response = 4),
  compute_number(question = qn_37, response = 1) + compute_number(question = qn_37, response = 2))

data_wide %>%
  filter(!is.na(scale)) %>%
  filter(scale != "") %>%
  group_by(scale, position) %>%
  summarise(Liczebność = n()) %>%
  arrange(desc(Liczebność)) %>%
  rename("Rodzaj kształcenia" = position,
         "Na ile zmienił się Twój kontakt z Promotorką / Promotorem (Opiekunem / Opiekunką naukową) podczas pandemii?" = scale) %>%
   kable(caption = cap, "html") %>%
      kable_styling(bootstrap_options = c("striped","hover"),
                    font_size = 10,
                    full_width = TRUE)

```

```{r promo-call-table,  layout="l-body-outset", fig.cap=cap}
cap <- sprintf("Większość (%i) doktorantek i doktorantów rozmawiała ze swoją Promotorką / Promotorem (Opiekunką / Opiekunem naukowym) w ciągu ostatnich dwóch tygodni. Jednakże jest też spora grupa %i doktorantek i doktorantów, która od ponad dwóch tygodni nie miała kontaktu ze swoją Promotorką / Promotorem (Opiekunką / Opiekunem naukowym). Co mało zaskakujące spora ich część uważa, że ich kontakt się pogorszył (%i)",
               compute_number(question = contact_label, response = "W ciągu ostatnich\n 2 tygodnii"),
               compute_number(question = contact_label, response = "Nie rozmawialiśmy /\nrozmawiałyśmy \nod 2 tygodni"),
               compute_number(question = contact_label, response = "Nie rozmawialiśmy /\nrozmawiałyśmy \nod 2 tygodni", conditional = TRUE, question2 = scale, response2 = "Jest gorzej"))

data_wide %>%
  filter(!is.na(contact_label)) %>%
  filter(scale != "") %>%
  group_by(contact_label, position) %>%
  summarise(Liczebność = n()) %>%
  arrange(desc(Liczebność)) %>%
  rename("Rodzaj kształcenia" = position,
         "Kiedy ostatnio rozmawiałaś / rozmawiałeś (przez telefon lub wykorzystując dostępne narzędzia informatyczne) ze swoją Promotorką / Promotorem (Opiekunem / Opiekunką naukową)?" = contact_label) %>%
   kable(caption = cap, "html") %>%
      kable_styling(bootstrap_options = c("striped","hover"),
                    font_size = 10,
                    full_width = TRUE)

```


# Dodatkowe pytanie

```{r table, fig.width=8, layout="l-body-outset"}
cap = question_show(question = "qn_46")
data_wide %>%
  filter(!is.na(qn_46)) %>%
  filter(nchar(qn_46) > 10) %>%
  filter(!qn_46 %in% c("nie dotyczy",
                       "Nie mam uwag.",
                       "Nie mam pomysłów",
                       "Nie dotyczy",
                       "Nie powinno być tak, że aby wypełnić ankietę obligatoryjne jest polecenie serialu.....")) %>%
  select(Jednostka =  faculty_label,
         position,
         Odpowiedź = qn_46) %>%
  ungroup() %>%
  mutate(id = 1:n(),
         Jednostka = as.factor(Jednostka),
         position = as.factor(position)) %>%
  rename("Rodzaj kształcenia" = position) %>%
  DT::datatable(caption = cap,
                rownames = FALSE,
                filter = "top",
                options = list(sDom  = '<"top">lrt<"bottom">ip'))

```

# TV

```{r series, fig.height=6, layout="l-body-outset"}
# temp_series <- data %>%
#   ungroup() %>%
#   filter(id %in% c(550:600)) %>%
#   recoder(table = .) %>%
#   tibble(series = .) %>%
#   bind_rows(read_csv2("data/data_series.csv"))
# 
# temp_series %>%
#   write_csv2("data/data_series.csv")

data_series <- read_csv2("data/data_series.csv") %>%
  mutate(series = str_split(series, pattern = ";")) %>%
  unnest(series)

SERIES_MAP = list(
  "La casa del papel" = c("Dom z papieru", "Dom z Papieru"),
  "Unorthodox" = c("Unorthodox", "Unorhtodox"),
  "Breaking Bad" = c("Breaking Bad","Breaking bad"),
  "Friends" = c("Friends", "Przyjaciele"),
  "Westworld" = c("Westworld", "West World"),
  "Ozark" = c("Ozark", "Ozarak"),
  "Peaky Blinders" = c("Peaky Blinders"),
  "The Suits" = c("Suits"),
  "Stranger Things" = c("Stranger Things"),
  "Better Call Saul" = c("Better Call Saul", "Better call Saul"),
  "Freud" = c("Freud"),
  "The Good Place" = c("The good place", "Good place", "The Good place"),
  "The Witcher" = c("Wiedźmin"),
  "BoJack Horseman" = c("Bojack Horseman", "BoJack Horseman"),
  "Twin Peaks" = c("Twin Peaks", "Twin peaks"),
  "Broadchurch" = c("Broadchurch", "Boradchurch"),
  "Brooklyn 9-9" = c("Brooklyn 99"),
  "The Crown" = c("The Crown"),
  "Chernobyl" = c("Czarnobyl"),
  "The Witcher" = c("Wiedźmin", "The Witcher")
)

map_table <- tibble(label = names(SERIES_MAP),
       series = map_depth(SERIES_MAP,1, as.vector)) %>%
  unnest(series)



data_series %>%
  left_join(map_table) %>%
  filter(!is.na(label)) %>%
  group_by(label) %>%
  summarise(count = n()) %>%
  arrange((count)) %>%
  mutate(label = as_factor(label)) %>%
  ggplot(aes(x = label, y = count)) +
  stat_summary(geom = "bar", show.legend = FALSE, fill = "#123e65") +
  theme_classic() +
  labs(x = "Tytuł", y = "Liczebność")+ 
  #annotation_custom(l, xmin = 0, xmax = 2, ymin = 36, ymax = 46) + 
  #coord_cartesian(clip = "off") +
  coord_flip() +
  scale_y_continuous(expand = expansion(mult = c(0, .1)))
```

# Appendix {.tabset}

## Wykresy

**`r question_show(question = 'qn_34')`**  

```{r appendix-plot-1, fig.height=6, layout="l-body-outset", fig.cap=cap}
cap <- sprintf("Z %i doktorantek i doktorantów aż %i utraciło źródło dochodu w związku z restrykcajmi wprowadzonymi przez Rząd",
               compute_number(question = qn_34, response = "Tak") + compute_number(question = qn_34, response = "Nie"),
               compute_number(question = qn_34, response = "Tak"))

order_faculties <- data_wide %>%
  filter(!is.na(faculty_label)) %>%
  group_by(faculty_shortcut) %>%
  filter(!faculty_shortcut %in% c("MSD UW", "SDNS UW", "SDNH UW", "SDNŚiP UW")) %>%
  summarise(count = n()) %>%
  arrange(count) %$%
  faculty_shortcut

data_wide %>%
  filter(!is.na(faculty_label)) %>%
  filter(! faculty_shortcut %in% c("MSD UW", "SDNS UW", "SDNH UW", "SDNŚiP UW")) %>%
  mutate(label = factor(faculty_shortcut, levels = order_faculties),
         position = factor(position, levels = c("Szkoła Doktorska", "Studia Doktoranckie" ))) %>%
  ggplot(aes(x = label, fill = qn_34)) +
  geom_bar() +
  theme_classic() +
  labs(x = "", y = "Liczebność")+ 
  #annotation_custom(l, xmin = -1, xmax = 4, ymin = 45, ymax = 60) + 
  #coord_cartesian(clip = "off") +
  coord_flip() +
  scale_y_continuous(expand = expansion(mult = c(0, .1))) +
  scale_fill_manual('', values=COLORS[2:1]) +
  theme(legend.position="bottom")
```

**`r question_show(question = 'qn_36')`**  

```{r appendix-plot-2, fig.height=6, layout="l-body-outset", fig.cap=cap}
cap <- sprintf("Z %i doktorantek i doktorantów aż %i obawia się że będzie musiało zrezygnować z doktoratu z powodu nowej sytuacji finansowej",
               compute_number(question = qn_36, response = "Tak") + compute_number(question = qn_36, response = "Nie"),
               compute_number(question = qn_36, response = "Tak"))

order_faculties <- data_wide %>%
  filter(!is.na(faculty_label)) %>%
  group_by(faculty_shortcut) %>%
  filter(!faculty_shortcut %in% c("MSD UW", "SDNS UW", "SDNH UW", "SDNŚiP UW")) %>%
  summarise(count = n()) %>%
  arrange(count) %$%
  faculty_shortcut

data_wide %>%
  filter(!is.na(faculty_label)) %>%
  filter(! faculty_shortcut %in% c("MSD UW", "SDNS UW", "SDNH UW", "SDNŚiP UW")) %>%
  mutate(label = factor(faculty_shortcut, levels = order_faculties),
         position = factor(position, levels = c("Szkoła Doktorska", "Studia Doktoranckie" ))) %>%
  ggplot(aes(x = label, fill = qn_36)) +
  geom_bar() +
  theme_classic() +
  labs(x = "", y = "Liczebność")+ 
  #annotation_custom(l, xmin = -1, xmax = 4, ymin = 45, ymax = 60) + 
  #coord_cartesian(clip = "off") +
  coord_flip() +
  scale_y_continuous(expand = expansion(mult = c(0, .1))) +
  scale_fill_manual('',values=COLORS[2:1]) +
  theme(legend.position="bottom")
```

## Tabele

**`r question_show(question = 'qn_34')`**

```{r appendix-table-1, fig.height=6, layout="l-body-outset"}
cap <- sprintf("Z %i doktorantek i doktorantów aż %i utraciło źródło dochodu w związku z restrykcajmi wprowadzonymi przez Rząd",
               compute_number(question = qn_34, response = "Tak") + compute_number(question = qn_34, response = "Nie"),
               compute_number(question = qn_34, response = "Tak"))

data_wide %>%
  filter(!is.na(faculty_label)) %>%
  filter(! faculty_shortcut %in% c("MSD UW", "SDNS UW", "SDNH UW", "SDNŚiP UW")) %>%
  mutate(label = factor(faculty_label)) %>%
  group_by(label, qn_34) %>%
  summarise(count = n()) %>%
  pivot_wider(values_from = count, names_from = qn_34) %>%
  mutate_at(vars(Tak:Nie), ~ifelse(is.na(.), 0, .)) %>%
  mutate("% Tak" = round(Tak * 100 / sum(Tak, Nie), 2)) %>%
  rename(Jednostka = label) %>%
  arrange(desc(Tak)) %>%
  kable(caption = cap, "html") %>%
      kable_styling(bootstrap_options = c("striped","hover"),
                    font_size = 10,
                    full_width = TRUE) %>%
  footnote(general = "Tabela jest posortowana po liczbie odpowiedzi Tak")
```

**`r question_show(question = 'qn_36')`**

```{r appendix-table-2, fig.height=6, layout="l-body-outset"}
cap <- sprintf("Z %i doktorantek i doktorantów aż %i obawia się że będzie musiało zrezygnować z doktoratu z powodu nowej sytuacji finansowej",
               compute_number(question = qn_36, response = "Tak") + compute_number(question = qn_36, response = "Nie"),
               compute_number(question = qn_36, response = "Tak"))

data_wide %>%
  filter(!is.na(faculty_label)) %>%
  filter(! faculty_shortcut %in% c("MSD UW", "SDNS UW", "SDNH UW", "SDNŚiP UW")) %>%
  mutate(label = factor(faculty_label)) %>%
  group_by(label, qn_36) %>%
  summarise(count = n()) %>%
  pivot_wider(values_from = count, names_from = qn_36) %>%
  mutate_at(vars(Tak:Nie), ~ifelse(is.na(.), 0, .)) %>%
  mutate("% Tak" = round(Tak * 100 / sum(Tak, Nie), 2)) %>%
  rename(Jednostka = label) %>%
  arrange(desc(Tak)) %>%
  kable(caption = cap, "html") %>%
      kable_styling(bootstrap_options = c("striped","hover"),
                    font_size = 10,
                    full_width = TRUE) %>%
  footnote(general = "Tabela jest posortowana po liczbie odpowiedzi Tak")
```
