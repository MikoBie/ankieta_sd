---
title: "R Notebook"
output: 
  
  bookdown::html_document2:
    toc: yes
    toc_depth: 3
    toc_float: yes
  word_document: default
always_allow_html: yes
---

```{r markdown_setup, include=FALSE}
knitr::opts_chunk$set(
    echo = FALSE,
    message = FALSE,
    warning = FALSE,
    base.dir = here::here(),
    fig.path = "figures/",
    eval.after = 'fig.cap',
    fig.width = 8,
    fig.height = 4
)
```

```{r libraries}
library(tidyverse)
library(magrittr)
library(lubridate)
library(kableExtra)
source("utils/utils.R")
source("utils/maps.R")
#l <- get_png("png/samorzad_doktorantow_logo.png")
COLORS <- c("#123e65",
            "#B3160E",
            "#1F6608")
```





```{r get_data}
data <- read_csv("data/Ankieta dla doktorantów (Odpowiedzi) - Liczba odpowiedzi_ 1.csv")

QUESTION_LOOKUP <- tibble(polski = colnames(data)[51:98],
                          english = colnames(data)[3:50]) %>%
  mutate(qn = paste0("qn_", 1:n())) %>%
  select(qn, polski, english) 

data <- read_csv("data/Ankieta dla doktorantów (Odpowiedzi) - Liczba odpowiedzi_ 1.csv") %>%
  rename(time = "Sygnatura czasowa",
         language = "Please select the language (choose wisely)") %>%
  mutate(id = 1:n()) %>%
  select(id, time, language, everything()) %>%
  pivot_longer(cols = c(4:99),
               names_to = "questions",
               values_to = "responses",
               values_ptypes = list(responses = character())) %>%
  filter(time > ymd_hms("2020-04-14 15:30:00")) %>%
  group_by(id) %>% 
  mutate(language_help = rep(c("English", "Polski"), each = 48)) %>%
  ungroup() %>%
  filter(language == language_help) %>%
  group_by(id) %>%
  mutate(qn = paste0("qn_", 1:n()),
         responses = trimws(responses))
  

data_wide <- data %>%
  pivot_wider(id_cols = id:language,
              names_from = qn,
              values_from = responses) %>%
  select(id, time, language, affiliation = qn_1, position = qn_2, przewod =  qn_5, teaching =  qn_13, classes = qn_21, series = qn_47, everything(), c(-qn_1, -qn_2, -qn_5, -qn_13, -qn_21, -qn_47)) %>%
  mutate_at(vars(qn_3:qn_48), ~ifelse(. == "Yes", "Tak", .)) %>%
  mutate_at(vars(qn_3:qn_48), ~ifelse(. == "No", "Nie", .)) %>%
  mutate(qn_22 = recode(qn_22,
         "None" = "Ani jedne",
         "Less than a half" = "Mniej niż połowa",
         "Half" = "Połowa",
         "More than a half" = "Więcej niż połowa",
         "All" = "Wszystkie")) %>%
  mutate_at(vars(qn_3:qn_48), ~ifelse(. == "I have not been in contact with administration recently", "Nie miałam / miałem kontaktu z administracją w mojej jednostce w ostatnim czasie", .)) %>%
  mutate_at(vars(qn_3:qn_48), ~ifelse(. == "Nie miałam / miałem kontaktu z administracją w mojej jednostce w ostatnim czasie", "Brak kontaktu", .)) %>%
  mutate_at(vars(qn_3:qn_48), ~ifelse(. == "Nie miałam / miałem kontaktu z administracją uniwersytecką w ostatnim czasie", "Brak kontaktu", .)) %>%
  left_join(facculties_map) %>%
  mutate(position = if_else(
    position %in% c(
      "PhD student from doctoral school",
      "doktorantką / doktorantem ze szkoły doktorskiej"),
    "Szkoła Doktorska",
    "Studia Doktoranckie"),
    position = factor(position, levels = c("Szkoła Doktorska", "Studia Doktoranckie")),
    doctoral_school = case_when(
    position == "Szkoła Doktorska" & science_label %in% c(
      "Nauki Społeczne") ~ "Szkoła Doktorska Nauk Społecznych",
    position == "Szkoła Doktorska" & science_label %in% c(
      "Nauki Humanistyczne") ~ "Szkoła Doktorska Nauk Humanistycznych",
    position == "Szkoła Doktorska" & science_label %in% c(
      "Nauki Ścisłe i Przyrodnicze") ~ "Szkoła Doktorska Nauk Ścisłych i Przyrodniczych",
    TRUE ~ "Międzydziedzinowa Szkoła Doktorska"
    ),
    doctoral_school = if_else(position == "Szkoła Doktorska",
                              doctoral_school,
                              "")) %>%
  mutate(scale = SCALE_MAP[qn_37 %>% as.numeric()] %>% names()) %>%
  left_join(contact_map)
  
         
```

# Ankietowani

```{r affiliation-plot, fig.height = 6, layout="l-body-outset", fig.cap=cap}
suma <- data_wide

cap <- sprintf(
  "W Anikiecie wzięło udział w sumie %.0f doktorantek i doktorantów, z czego %.0f kształci się na studiach doktoranckich, a %.0f w szkołach doktorskich. Najliczeniejszą reprezentację w badaniu miał %s z którego w badaniu wzięło udział %i doktorantek i doktorantów.",
  data_wide %>% nrow,
  compute_number(question = position, response = "Studia Doktoranckie"),
  compute_number(question = position, response = "Szkoła Doktorska"),
  data_wide %>% group_by(faculty_label) %>% summarise(count = n()) %>% arrange(desc(count)) %>% slice(1) %>% pull(faculty_label),
  data_wide %>% group_by(faculty_label) %>% summarise(count = n()) %>% arrange(desc(count)) %>% slice(1) %>% pull(count)
  )

order_faculties <- data_wide %>%
  filter(!is.na(faculty_label)) %>%
  group_by(faculty_shortcut) %>%
  filter(!faculty_shortcut %in% c("MSD UW", "SDNS UW", "SDNH UW", "SDNŚiP UW")) %>%
  summarise(count = n()) %>%
  arrange(count) %$%
  faculty_shortcut

data_wide %>%
  filter(!is.na(faculty_label)) %>%
  filter(! faculty_shortcut %in% c("MSD UW", "SDNS UW", "SDNH UW", "SDNŚiP UW")) %>%
  mutate(label = factor(faculty_shortcut, levels = order_faculties),
         position = factor(position, levels = c("Szkoła Doktorska", "Studia Doktoranckie" ))) %>%
  ggplot(aes(x = label, fill = position)) +
  geom_bar() +
  theme_classic() +
  labs(x = "", y = "Liczebność")+ 
  #annotation_custom(l, xmin = -1, xmax = 4, ymin = 45, ymax = 60) + 
  #coord_cartesian(clip = "off") +
  coord_flip() +
  scale_y_continuous(expand = expansion(mult = c(0, .1))) +
  scale_fill_manual(values=COLORS[1:2], limits = c("Studia Doktoranckie", "Szkoła Doktorska")) +
  theme(legend.position="bottom", legend.title = element_blank())
```
```{r science-plot, layout="l-body-outset", fig.cap=cap}
order_sciencies <- data_wide %>%
  filter(science_label != "") %>%
  group_by(science_label) %>%
  summarise(count = n()) %>%
  arrange(count) %$%
  science_label

data_wide %>%
  filter(science_label != "") %>%
  mutate(label = factor(science_label, levels = order_sciencies),
         position = factor(position, levels = c("Szkoła Doktorska", "Studia Doktoranckie" ))) %>%
  ggplot(aes(x = label, fill = position)) +
  geom_bar() +
  theme_classic() +
  labs(x = "", y = "Liczebność")+ 
  #annotation_custom(l, xmin = -3, xmax = 4, ymin = 165, ymax = 195) + 
  #coord_cartesian(clip = "off") +
  coord_flip() +
  scale_y_continuous(expand = expansion(mult = c(0, .1))) +
  scale_fill_manual(values=COLORS[1:2], limits = c("Studia Doktoranckie", "Szkoła Doktorska")) +
  theme(legend.position="bottom", legend.title = element_blank())
cap <- sprintf(
  "Z %i doktorantek i doktorantów, którzy wzięli udział w badaniu najwięcej reprezentowało %s - %i; %s reprezentowało %i, a %s - %i (dla 13 doktorantek i doktorantów nie udało się ustalić dziedziny nauki).",
  data_wide %>% nrow,
  data_wide %>% group_by(science_label) %>% summarise(count = n()) %>% arrange(desc(count)) %>% slice(1) %>% pull(science_label),
  data_wide %>% group_by(science_label) %>% summarise(count = n()) %>% arrange(desc(count)) %>% slice(1) %>% pull(count),
  data_wide %>% group_by(science_label) %>% summarise(count = n()) %>% arrange(desc(count)) %>% slice(2) %>% pull(science_label),
  data_wide %>% group_by(science_label) %>% summarise(count = n()) %>% arrange(desc(count)) %>% slice(2) %>% pull(count),
  data_wide %>% group_by(science_label) %>% summarise(count = n()) %>% arrange(desc(count)) %>% slice(3) %>% pull(science_label),
  data_wide %>% group_by(science_label) %>% summarise(count = n()) %>% arrange(desc(count)) %>% slice(3) %>% pull(count))
```

# Stypendium i Socjal

Pytania dotyczące stypendium naukowego oczywiście dotyczyło wyłącznie doktorantek i doktorantów, którzy są na studiach doktoranckich. Na razie nie analizowałem pytań otwartych, liczę na to, że znajdę na to trochę czasu w najbliższy weekend. Może w tych odpowiedziach otwartych jest jakieś rozwiązanie co zrobić z kryteriami stypendiów.

```{r przewod-plot, layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_3,
                   conditional = TRUE,
                   question2 = qn_3,
                   legend = FALSE,
                   reorder = FALSE,
                   ymin = 195,
                   ymax = 225,
                   COLORS = COLORS[2:1],
                   plot_title = question_show(question = "qn_3"))
cap <- sprintf(
  "Wśród %i doktorantek i doktorantów, którzy przygotowują rozprawę doktorską w ramach studiów doktoranckich ponad połowa (%i) obawia się, że w związku z pandemią koronawirusa może mieć problem z otrzymaniem stypendium w przyszłym roku akademickim.",
  compute_number(question = qn_3, response = "Tak") + compute_number(question = qn_3, response = "Nie"),
  compute_number(question = qn_3, response = "Tak"))
```

```{r przewod-plot-2, layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_3,
                   conditional = TRUE,
                   question2 = qn_34,
                   legend = TRUE,
                   reorder = FALSE,
                   ymin = 195,
                   ymax = 225,
                   COLORS = COLORS[2:1],
                   legend_title = "Czy w związku z wprowadzonymi przez Rząd restrykcjami utraciłaś / utraciłeś źródło dochodu?",
                   plot_title = question_show(question = "qn_3"))
cap <- sprintf(
  "Wśród %i doktorantek i doktorantów, którzy obawiają się, że w związku z pandemią koronawirusa mogą mieć problem z uzyskaniem stypendium w przyszłym roku %i utraciło źródło dochodu w konsekwencji restrykcji wprowadzonych przez Rząd. W grupie %i doktorantek i doktorantów, którzy nie obawiają się, że w związku z pandemią koronawirusa mogą mieć problem z uzyskaniem stypendium w przyszłym roku %i utraciło źródło dochodu.",
  compute_number(question = qn_3, response = "Tak"),
  compute_number(question = qn_3, response = "Tak", conditional = TRUE, question2 = qn_34, response2 = "Tak"),
  compute_number(question = qn_3, response = "Nie"),
  compute_number(question = qn_3, response = "Nie", conditional = TRUE, question2 = qn_34, response2 = "Tak"))
```

# Obrona przed 2021

To moim zdaniem jest dość wymowne. Niby jest jeszcze ponad półtora roku i dopiero nic nie robimy miesiąc, a osoby z otwartymi przewodami mają już te przewody otwarte przynajmniej od roku, to jednak wyobrażam sobie, że są osoby, które jeszcze przez jakiś czas nie będą mogły skończyć badań. Co w jakimś stopniu jest zaskakujące to fakt, że najwięcej jest osób z nauk humanistycznych, które deklarują, że będą mieć problem z obroną przed grudniem 2021.

```{r obrona-plot,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_6,
                   conditional = TRUE,
                   question2 = science_label,
                   COLORS = COLORS[1:3],
                   legend = TRUE,
                   plot_title = question_show(question = "qn_6"))
cap <- sprintf(
  "Z %i doktorantek i doktorantów, którzy mają otwarty przewód doktorski ponad połowa (%i) uważa, że aktualna sytuacja może utrudnić im obronę przed grudniem 2021. Najwięcej bo %i doktorantek i doktorantów, którzy obawiają czy zdążą się obronić przed grudniem 2021 reprezentuje Nauki Humanistyczne, Nauki Społeczne - %i, a Nauki Ścisłe i Przyrodnicze - %i (u dwóch osób ciężko jest zidentyfikować dziedzinę nauki).",
  compute_number(question = qn_6, response = "Tak") + compute_number(question = qn_6, response = "Nie"),
  compute_number(question = qn_6, response = "Tak"),
  compute_number(question = qn_6, response = "Tak", conditional = TRUE, question2 = science_label, response2 = "Nauki Humanistyczne"),
  compute_number(question = qn_6, response = "Tak", conditional = TRUE, question2 = science_label, response2 = "Nauki Społeczne"),
  compute_number(question = qn_6, response = "Tak", conditional = TRUE, question2 = science_label, response2 = "Nauki Ścisłe i Przyrodnicze")
  )
```

```{r obrona-plot-2,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_6,
                   conditional = TRUE,
                   question2 = qn_39,
                   COLORS = COLORS[2:1],
                   legend = TRUE,
                   legend_title = "Czy ograniczenia na UW wpływają na badania do Twojego Doktoratu?",
                   plot_title = question_show(question = "qn_6"))
cap <- sprintf(
  "Z %i doktorantek i doktorantów, którzy mają otwarty przewód doktorski ponad połowa (%i) uważa, że aktualna sytuacja może utrudnić im obronę przed grudniem 2021. Co więcej dla większości tych doktorantów i doktorantek (%i!) ograniczenia związane z pandemią koronawirusa, w tym te w funkcjonowaniu Uniwersytetu Warszawskiego, wpływają na realizację badań w przygotowywanej rozprawie doktorskiej. W przypadku osób, które nie obawiają się wpływu pandemii na obronę przed grudniem 2021, nie może realizować badań do doktoratu ponad połowa - %i.",
  compute_number(question = qn_6, response = "Tak") + compute_number(question = qn_6, response = "Nie"),
  compute_number(question = qn_6, response = "Tak"),
  compute_number(question = qn_6, response = "Tak", conditional = TRUE, question2 = qn_39, response2 = "Tak"),
  compute_number(question = qn_6, response = "Nie", conditional = TRUE, question2 = qn_39, response2 = "Tak")
  )
```

```{r obrona-plot-3,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_6,
                   conditional = TRUE,
                   question2 = scale,
                   COLORS = COLORS[2:1],
                   legend = TRUE,
                   legend_title = "Na ile zmienił się Twój kontakt z Promotorem / Promotorką?",
                   plot_title = question_show(question = "qn_6"))
cap <- sprintf(
  "Z %i doktorantek i doktorantów, którzy mają otwarty przewód doktorski ponad połowa (%i) uważa, że aktualna sytuacja może utrudnić im obronę przed grudniem 2021. Jednak tylko %i doktorantek i doktorantów, którzy będą mieć ten problem jednocześnie uważa, ze ich kontakt z Promotorem / Promotorką się pogorszył.",
  compute_number(question = qn_6, response = "Tak") + compute_number(question = qn_6, response = "Nie"),
  compute_number(question = qn_6, response = "Tak"),
  compute_number(question = qn_6, response = "Tak", conditional = TRUE, question2 = scale, response2 = "Jest gorzej")
  )
```
```{r obrona-plot-4,  layout="l-body-outset", fig.cap=cap}
cap <- sprintf(
  "Z %i doktorantek i doktorantów, którzy mają otwarty przewód doktorski ponad połowa (%i) uważa, że aktualna sytuacja może utrudnić im obronę przed grudniem 2021. Jednak tylko %i doktorantek i doktorantów, którzy będą mieć ten problem jednocześnie obawia się, że będzie mieć problem z terminową realizacją kształcenia na studiach doktoranckich.",
  compute_number(question = qn_6, response = "Tak") + compute_number(question = qn_6, response = "Nie"),
  compute_number(question = qn_6, response = "Tak"),
  compute_number(question = qn_6, response = "Tak", conditional = TRUE, question2 = qn_44, response2 = "Tak"))

plot_con_questions(question = qn_6,
                   conditional = TRUE,
                   question2 = qn_44,
                   legend_title = "Czy obawiasz się aktualna sytuacja wpływa na terminową realizację programów studiów doktoranckich?",
                   COLOR = COLORS[2:1],
                   ymin = 300,
                   ymax = 330,
                   plot_title = question_show(question = "qn_6"))
```


# Procedura Nadania Stopnia

```{r obrona-procedura,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_9,
                   conditional = TRUE,
                   question2 = qn_8,
                   legend_title = "Czy w bieżącym roku akademickim zamierzasz wszcząć procedurę nadania stopnia doktora?",
                   COLORS = COLORS[2:1],
                   ymin = 170,
                   ymax = 200,
                   plot_title = question_show(question = "qn_9"))
cap <- sprintf(
  "Z %i doktorantek i doktorantów, które są na studiach doktoranckich i nie mają otwartego przewodu, zdecydowana większość (%i) uważa, że aktualna sytuacja nie wpłynie na ich plany rozpoczęcia procedury nadania stopnia doktora. Jednak warto zauważyć, że aż %i z %i osób, które uważają, że aktualna sytuacja wpłynie na procedurę rozpoczęcia nadania stopnia doktora planowało wszcząć procedurę nadania stopnia doktora w tym roku akademickim.",
  compute_number(question = qn_9, response = "Tak") + compute_number(question = qn_9, response = "Nie"),
  compute_number(question = qn_9, response = "Nie"), compute_number(question = qn_9, response = "Tak", conditional = TRUE, question2 = qn_8, response2 = "Tak"),
  compute_number(question = qn_9, response = "Tak"))
```

```{r obrona-procedura-2,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_9,
                   conditional = TRUE,
                   question2 = qn_39,
                   COLORS = COLORS[2:1],
                   legend = TRUE,
                   legend_title = "Czy ograniczenia na UW wpływają na badania do Twojego Doktoratu",
                   plot_title = question_show(question = "qn_9"))
cap <- sprintf(
  "Z %i doktorantek i doktorantów, którzy nie mają otwartego przewodu doktorskiego zdecydowana większość  (%i) uważa, że aktualna sytuacja nie wpłynie na wszczęcie przez nich procedury nadania stopnia doktora. Jednak aż dla %i z %i osób, dla których ograniczenia związane z pandemią koronawirusa, wpływają na wszczęcie procedury nadania stopnia doktora równocześnie ograniczenia wpływają na przeprowadzenie badań do przygotowywanej rozprawie doktorskiej. W przypadku osób, które nie obawiają się wpływu pandemii na wszczęcie procedury nadania stopnia doktora, nie może realizować badań aż %i.",
  compute_number(question = qn_9, response = "Tak") + compute_number(question = qn_9, response = "Nie"),
  compute_number(question = qn_9, response = "Nie"),
  compute_number(question = qn_9, response = "Tak", conditional = TRUE, question2 = qn_39, response2 = "Tak"),
  compute_number(question = qn_9, response = "Tak"),
  compute_number(question = qn_9, response = "Nie", conditional = TRUE, question2 = qn_39, response2 = "Tak")
  )
```

```{r obrona-procedura-3,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_9,
                   conditional = TRUE,
                   question2 = scale,
                   COLORS = COLORS[2:1],
                   legend = TRUE,
                   legend_title = "Na ile zmienił się Twój kontakt z Opiekunką / Opiekunem",
                   plot_title = question_show(question = "qn_9"))
cap <- sprintf(
  "Z %i doktorantek i doktorantów, którzy nie mają otwartego przewodu doktorskiego zdecydowana większość  (%i) uważa, że aktualna sytuacja nie wpłynie na wszczęście przez nich procedury nadania stopnia doktora. Tylko %i doktorantek i doktorantów, którzy będą mieć ten problem jednocześnie uważa, ze ich kontakt z Promotorem / Promotorką się pogorszył.",
  compute_number(question = qn_9, response = "Tak") + compute_number(question = qn_9, response = "Nie"),
  compute_number(question = qn_9, response = "Nie"),
  compute_number(question = qn_9, response = "Tak", conditional = TRUE, question2 = scale, response2 = "Jest gorzej")
  )
```
```{r obrona-procedura-4,  layout="l-body-outset", fig.cap=cap}
cap <- sprintf(
  "Z %i doktorantek i doktorantów, którzy nie mają otwartego przewodu doktorskiego zdecydowana większość  (%i) uważa, że aktualna sytuacja nie wpłynie na wszczęście przez nich procedury nadania stopnia doktora. Jednak prawie połowa (%i z %i) doktorantek i doktorantów, którzy będą mieć ten problem jednocześnie obawia się, że będzie mieć problem z terminową realizacją kształcenia na studiach doktoranckich.",
  compute_number(question = qn_9, response = "Tak") + compute_number(question = qn_9, response = "Nie"),
  compute_number(question = qn_9, response = "Nie"),
  compute_number(question = qn_9, response = "Tak", conditional = TRUE, question2 = qn_44, response2 = "Tak"),
  compute_number(question = qn_9, response = "Tak"))

plot_con_questions(question = qn_9,
                   conditional = TRUE,
                   question2 = qn_44,
                   legend_title = "Czy ograniczenia wpływają na terminową realizację kształcenia?",
                   COLOR = COLORS[2:1],
                   ymin = 300,
                   ymax = 330,
                   plot_title = question_show(question = "qn_9"))
```

# IPB

```{r obrona-plan,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_11,
                   conditional = TRUE,
                   question2 = science_label,
                   COLORS = COLORS,
                   legend = TRUE,
                   ymax = 54,
                   ymin = 47,
                   plot_title = question_show(question = "qn_11"))
cap <- sprintf(
  "Z %i doktorantek i doktorantów kształcących się w szkołach doktorskich, ponad połowa (%i) spodziewa się, że w związku z ogłoszoną decyzją o wprowadzeniu zdalnego nauczania na Uniwersytecie Warszawskim do 15 maja 2020 oraz szeregiem ograniczeń w tym semestrze, będzie miała problem z przygotowaniem Indywidualnego Planu Badawczego. Najwięcej takich doktorantek i doktorantów reprezentuje Nauki Humanistyczne - %i, Nauki Ścisłe i Przyrodnicze - %i, a Nauki Społeczne - %i (u jednej osoby ciężko było zidentyfikować dziedzinę nauki).",
  compute_number(question = qn_11, response = "Tak") + compute_number(question = qn_11, response = "Nie"),
  compute_number(question = qn_11, response = "Tak"),
  compute_number(question = qn_11, response = "Tak", conditional = TRUE, question2 = science_label, response2 = "Nauki Humanistyczne"),
  compute_number(question = qn_11, response = "Tak", conditional = TRUE, question2 = science_label, response2 = "Nauki Społeczne"),
  compute_number(question = qn_11, response = "Tak", conditional = TRUE, question2 = science_label, response2 = "Nauki Ścisłe i Przyrodnicze")
  )
```

```{r obrona-plan-2,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_11,
                   conditional = TRUE,
                   question2 = qn_39,
                   COLORS = COLORS[2:1],
                   legend = TRUE,
                   legend_title = "Czy ograniczenia na UW wpływają na badania do Twojego Doktoratu",
                   plot_title = question_show(question = "qn_11"))
cap <- sprintf(
  "Z %i doktorantek i doktorantów kształcących się w szkołach doktorskich, połowa (%i) spodziewa się, że w związku z ogłoszoną decyzją o wprowadzeniu zdalnego nauczania na Uniwersytecie Warszawskim do 15 maja 2020 oraz szeregiem ograniczeń w tym semestrze, będzie miała problem z przygotowaniem Indywidualnego Planu Badawczego. Większość (%i!) z tych, dla których będzie to problem równocześnie nie może prowadzić badań do doktoratu. W przypadku osób, które nie obawiają się wpływu pandemii na przygotowanie Indywidualnego Planu Badawczego, nie może realizować badań %i osób.",
  compute_number(question = qn_11, response = "Tak") + compute_number(question = qn_11, response = "Nie"),
  compute_number(question = qn_11, response = "Tak"),
  compute_number(question = qn_11, response = "Tak", conditional = TRUE, question2 = qn_39, response2 = "Tak"),
  compute_number(question = qn_11, response = "Nie", conditional = TRUE, question2 = qn_39, response2 = "Tak")
  )
```

```{r obrona-plan-3,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_11,
                   conditional = TRUE,
                   question2 = scale,
                   COLORS = COLORS[2:1],
                   legend = TRUE,
                   legend_title = "Na ile zmienił się Twój kontakt z Promotorem / Promotorką",
                   plot_title = question_show(question = "qn_11"))
cap <- sprintf(
  "Z %i doktorantek i doktorantów kształcących się w szkołach doktorskich, połowa (%i) spodziewa się, że w związku z ogłoszoną decyzją o wprowadzeniu zdalnego nauczania na Uniwersytecie Warszawskim do 15 maja 2020 oraz szeregiem ograniczeń w tym semestrze, będzie miała problem z przygotowaniem Indywidualnego Planu Badawczego. Prawie połowa (%i) doktorantek i doktorantów, którzy będą mieć ten problem jednocześnie uważa, ze ich kontakt z Promotorem / Promotorką się pogorszył. Wśród tych, którzy nie obawiają się, że będą mieć problem z przygotowaniem Indywidualnego Planu Badawczego tylko %i osób uważa, że ich kontakt się pogorszył.",
  compute_number(question = qn_11, response = "Tak") + compute_number(question = qn_11, response = "Nie"),
  compute_number(question = qn_11, response = "Tak"),
  compute_number(question = qn_11, response = "Tak", conditional = TRUE, question2 = scale, response2 = "Jest gorzej"),
  compute_number(question = qn_11, response = "Nie", conditional = TRUE, question2 = scale, response2 = "Jest gorzej")
  )
```

```{r obrona-plan-4,  layout="l-body-outset", fig.cap=cap}
cap <- sprintf(
  "Z %i doktorantek i doktorantów kształcących się w szkołach doktorskich, ponad połowa (%i) spodziewa się, że w związku z ogłoszoną decyzją o wprowadzeniu zdalnego nauczania na Uniwersytecie Warszawskim do 15 maja 2020 oraz szeregiem ograniczeń w tym semestrze, będzie miała problem z przygotowaniem Indywidualnego Planu Badawczego. Prawie połowa (%i) doktorantek i doktorantów, którzy będą mieć ten problem jednocześnie obawia się, że będzie mieć problem z terminową realizacją kształcenia w szkole doktorskiej (Mikołaj: w sumie wszyscy powinni się obawiać, bo przecież przygotowanie IPB jest częścią terminowej realizacji kształcenia).",
  compute_number(question = qn_11, response = "Tak") + compute_number(question = qn_11, response = "Nie"),
  compute_number(question = qn_11, response = "Tak"),
  compute_number(question = qn_11, response = "Tak", conditional = TRUE, question2 = qn_44, response2 = "Tak"))

plot_con_questions(question = qn_11,
                   conditional = TRUE,
                   question2 = qn_44,
                   legend_title = "Czy ograniczenia wpływają na terminową realizację kształcenia?",
                   COLOR = COLORS[2:1],
                   ymin = 300,
                   ymax = 330,
                   plot_title = question_show(question = "qn_11"))
```

# Uczenie

```{r zajecia-zdalne,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_14,
                   conditional = TRUE,
                   question2 = qn_17,
                   legend_title = "Czy masz warunki doprowadzenia zajęć zdalnych?",
                   ymin = 160,
                   ymax = 190,
                   COLORS = COLORS[2:1],
                   plot_title = question_show(question = "qn_14"))

cap <- sprintf(
  "Z %i doktorantek i doktorantów prowadzących zajęcia zdecydowana większość (%i) prowadzi zajęcia zdalnie. Jednak warto zwrócić uwagę na to, że aż %i z doktorantek i doktorantów  z %i doktorantek i doktorantów nieprowadzących zajęć nie ma warunków do prowadzenia zajęć zdalnych.",
  compute_number(question = qn_14, response = "Tak") + compute_number(question = qn_14, response = "Nie"),
  compute_number(question = qn_14, response = "Tak"),
  compute_number(question = qn_14, response = "Nie", conditional = TRUE, question2 = qn_17, response2 = "Tak"),
  compute_number(question = qn_14, response = "Nie"))
```

```{r zajecia-zdalne-pomoc,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_14,
                   conditional = TRUE,
                   question2 = qn_15,
                   legend_title = "Czy pomagasz prowadzić zajęcia zdalne na Uniwersytecie Warszawskim?",
                   COLORS = COLORS[2:1],
                   ymin = 160,
                   ymax = 190,
                   plot_title = question_show(question = "qn_14"))
cap <- sprintf(
  "Z %i doktorantek i doktorantów, która prowadzi zajęcia zdalne %i dodatkowo pomaga prowadzić zajęcia zdalne, spośród tych którzy nie prowadzą zajęć zdalnych pomaga %i.",
  compute_number(question = qn_14, response = "Tak"),
  compute_number(question = qn_14, response = "Tak", conditional = TRUE, question2 = qn_15, response2 = "Tak"),
  compute_number(question = qn_14, response = "Nie", conditional = TRUE, question2 = qn_15, response2 = "Tak"))
```

```{r zajecia-zdalne-kurs,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_14,
                   conditional = TRUE,
                   question2 = qn_20,
                   legend_title = "Czy jesteś zainteresowana /  zainteresowany udziałem w kursie online, doskonalącym umiejętności nauczania zdalnego?",
                   COLORS = COLORS[2:1],
                   ymin = 160,
                   ymax = 190,
                   plot_title = question_show(question = "qn_14"))
cap <- sprintf("Z %i doktorantek i doktorantów, która prowadzi zajęcia zdalne %i jest zainteresowanych uczestnictwem w kursie doskonalącym umiejętności nauczania zdalnego, spośród tych którzy nie prowadzą zajęć zdalnych zainteresowanych jest %i.",
               compute_number(question = qn_14, response = "Tak"),
               compute_number(question = qn_14, response = "Tak", conditional = TRUE, question2 = qn_20, response2 = "Tak"),
               compute_number(question = qn_14, response = "Nie", conditional = TRUE, question2 = qn_20, response2 = "Tak"))
```

# Zajęcia

```{r uczestnictwo-zdalne,  layout="l-body-outset", fig.cap=cap}
cap <- sprintf(
  "Aż %i doktorantów i doktorantek deklaruje, że wszystkie ich zajęcia odbywają się zdalnie. Z drugiej jednak strony aż dla %i ani jedne zajęcia nie odbywają się w trybie zdalnym. Co zaskakujące najwięcej bo %i osób z Nauk Humanistycznych zadeklarowało, że żadne ich zajęcia nie odbywają się zdalnie.",
  compute_number(question = qn_22, response = "Wszystkie"),
  compute_number(question = qn_22, response = "Ani jedne"),
  compute_number(question = qn_22, response = "Ani jedne", conditional = TRUE, question2 = science_label, response2 = "Nauki Humanistyczne"))

order_qn22 <- data_wide %>%
  filter(!is.na(qn_22) & science_label != "") %>%
  group_by(qn_22) %>%
  summarise(count = n()) %>%
  arrange(count) %$%
  qn_22

data_wide %>%
  filter(!is.na(qn_22) & science_label != "") %>%
  mutate(label = factor(qn_22, levels = order_qn22),
         science_label = factor(science_label, levels = c("Nauki Humanistyczne", "Nauki Społeczne", "Nauki Ścisłe i Przyrodnicze"))) %>%
  ggplot(aes(x = label, fill = science_label)) +
  geom_bar() +
  theme_classic() +
  labs(x = "", y = "Liczebność")+ 
  #annotation_custom(l, xmin = -1, xmax = 2.2, ymin = 112, ymax = 137) + 
  #coord_cartesian(clip = "off") +
  coord_flip() +
  scale_y_continuous(expand = expansion(mult = c(0, .1))) +
  scale_fill_manual(values=COLORS, limits = c("Nauki Humanistyczne", "Nauki Społeczne", "Nauki Ścisłe i Przyrodnicze")) +
  theme(legend.position="bottom", legend.title = element_blank())
```

```{r zajecia-zdalne-kurs-2,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_23,
                   conditional = TRUE,
                   question2 = qn_23,
                   legend_title = "",
                   COLORS = COLORS[2:1],
                   ymin = 160,
                   ymax = 190,
                   plot_title = question_show(question = "qn_23"))
cap <- sprintf("Z %i doktorantek i doktorantów, którzy uczestniczą w tym semestrze w zajęciach %i ma warunki do uczestniczenia w zajęciach zdalnych.",
               compute_number(question = qn_23, response = "Tak") + compute_number(question = qn_23, response = "Nie"),
               compute_number(question = qn_23, response = "Tak"))
```

Na razie nie przyglądałem się pozostałym pytaniom otwartym. Chciałem wypisać tylko te pozytywne przykłady. Smutne jest tylko to, że większość doktorantów i doktorantek nie umie obsługiwać komputera albo nie rozumie pytania. Jeśli pytanie jest nieobowiązkowe to naprawdę nie trzeba w nim pisać odpowiedzi typu: ,,Nie mam zdania'' itp.


```{r table_good_examples, fig.width=8, layout="l-body-outset"}
cap = question_show(question = "qn_24")
data_wide %>%
  filter(!is.na(qn_24)) %>%
  filter(nchar(qn_24) > 10) %>%
  filter(!qn_24 %in% c("Żadne zajęcia",
                       "Nie dotyczy",
                       "póki co wszystko jest w stadium organizacji",
                       "Żadne się do tego nie nadają",
                       "Żadne, na które jestem zapisana.",
                       "Jedynie wykłady mają sens być prowadzone zdalnie.",
                       "nie dotyczy - moje zajęcia, w których jestem uczestniczką nie odbywają się zdalnie",
                       "nd, brak zajęć zdalnych na moich studiach",
                       "Zajęcia na wydziale nie są prowadzone zdalnie. Przesłanie prezentacji, pełnej błędów, klejonej na szybko przez prof szatur jaworską uważam za kompletne nieporozumienie. Osoba prowadząca drugi przedmiot prof. Stanisław Bieleń, jak dotychczas nie nawiązał jakiejkolwiek interakcji z doktorantami,",
                       "To są oguny",
                       "Żadne, uważam, że przesyłanie prezentacji to nie jest prowadzenie zajęć online.",
                       "pierwsze spotkanie dopiero się odbędzie",
                       "Będę miała pierwsze w końcu kwietnia, zatem nie mogę odpowiedzieć na to pytanie",
                       "Nie mam zdania.",
                       "Nie mogę ocenić",
                       "Żadne (ale jedne jeszcze się nie odbyły)",
                       "Jeszcze się nie odbyły :)",
                       "Brak takich zajęć")) %>%
  select(Jednostka =  faculty_label, Odpowiedź = qn_24) %>%
  ungroup(id) %>%
  mutate(id = 1:n()) %>%
  kable(caption = cap, "html") %>%
   kable_styling(bootstrap_options = c("striped","hover"),
                font_size = 10,
                full_width = TRUE) %>%
  scroll_box(width = "100%", height = "600px")

```

# Administracja

```{r admin-info,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_27,
                   conditional = TRUE,
                   question2 = position,
                   COLOR = COLORS[2:1],
                   ymin = 450,
                   ymax = 510,
                   plot_title = question_show(question = "qn_27"))
cap <- sprintf(
  "Z %i doktorantek i doktorantów, którzy wzięli udział w ankiecie aż %i dostaje informacje na temat zmian w funkcjonowaniu Uniwersytetu Warszawskiego od swojej jednostki.",
  compute_number(question = qn_27, response = "Tak") + compute_number(question = qn_27, response = "Nie"),
  compute_number(question = qn_27, response = "Tak"))
```

```{r admin-jednostka,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_28,
                   conditional = TRUE,
                   question2 = position,
                   COLOR = COLORS[2:1],
                   ymin = 240,
                   ymax = 270,
                   plot_title = question_show(question = "qn_28"))
cap <- sprintf(
  "Z %i doktorantek i doktorantów tylko %i ocenia pracę administracji w swojej jednostce w sposób negatywny.",
  compute_number(question = qn_28, response = "Tak") + compute_number(question = qn_28, response = "Nie") + compute_number(question = qn_28, response = "Brak kontaktu"),
  compute_number(question = qn_28, response = "Nie"))
```

```{r admin-uw,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_29,
                   conditional = TRUE,
                   question2 = position,
                   COLOR = COLORS[2:1],
                   plot_title = question_show(question = "qn_29"))
cap <- sprintf(
  "Z %.0f doktorantek i doktorantów tylko %.0f ocenia pracę administracji uniwersyteckiej w sposób negatywny.",
  compute_number(question = qn_29, response = "Tak") + compute_number(question = qn_29, response = "Nie") + compute_number(question = qn_29, response = "Brak kontaktu"),
  compute_number(question = qn_29, response = "Nie"))
```

To jest chyba najsmutniejszy wykres świata. Strona samorządu przegrywa z Monitorem UW. Ja to myślałem, że tylko pasjonaci zaglądają na stronę Monitora, a tu widać jestem jeszcze większym pasjonatem bo zaglądam na stronę Samorządu. Za to jeśli chodzi o Facebooka to idziemy łeb w łeb z UW.

```{r sources,  layout="l-body-outset", fig.cap=cap}
data_temp <- data_wide %>%
  mutate(qn_31 = str_split(qn_31, pattern = ",")) %>% 
  unnest(qn_31) %>%
  mutate(qn_31 = trimws(qn_31)) %>% 
  ungroup(id) %>%
  left_join(source_map)

cap <- sprintf("Najczęstszym deklarowanym źródłem informacji jest jednostka, aż %i doktorantów i doktorantek dostaje informacje z tego źródła. Potem jest Lista Mailingowa itd. Najsmutniejsze jest to, że Strona Samorządu UW przegrywa %i do %i z Monitorem UW.", compute_number(table = data_temp, question = source_label, response = "Z jednostki"), compute_number(table = data_temp, question = source_label, response = "Ze strony SD UW"), compute_number(table = data_temp, question = source_label, response = "Z Monitora UW"))

order_sources <- data_temp %>%
  filter(!is.na(source_label)) %>%
  group_by(source_label) %>%
  summarise(count = n()) %>%
  arrange(count) %$%
  source_label

data_temp %>%
  filter(!is.na(source_label)) %>%
  mutate(label = factor(source_label, levels = order_sources),
         position = factor(position, levels = c("Szkoła Doktorska", "Studia Doktoranckie" ))) %>%
  ggplot(aes(x = label, fill = position)) +
  geom_bar() +
  theme_classic() +
  labs(title = question_show(question = "qn_31"), x = "", y = "Liczebność")+ 
  #annotation_custom(l, xmin = -1, xmax = 4, ymin = 45, ymax = 60) + 
  #coord_cartesian(clip = "off") +
  coord_flip() +
  scale_y_continuous(expand = expansion(mult = c(0, .1))) +
  scale_fill_manual(values=COLORS[1:2], limits = c("Studia Doktoranckie", "Szkoła Doktorska")) +
  theme(legend.position="bottom", legend.title = element_blank())
```

```{r admin-spotkanie,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_30,
                   conditional = TRUE,
                   question2 = position,
                   COLOR = COLORS[2:1],
                   ymin = 450,
                   ymax = 510,
                   plot_title = question_show(question = "qn_30"))
cap <- sprintf(
  "Odpowiedź na to pytanie to jest moim zdaniem porażka Władz Rektorskich. Z jednej strony tę ankietę wypełniło %i osób z drugiej strony w spotkaniu z Panią Rektor wzięło udział tylko %i z nich. Następnym razem takie informacje muszą iść przez Listę Mailingową.",
  compute_number(question = qn_30, response = "Tak") + compute_number(question = qn_30, response = "Nie"),
  compute_number(question = qn_30, response = "Tak"))
```


# Sytuacja Socjalna

```{r social-dochod,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_34,
                   conditional = TRUE,
                   question2 = qn_36,
                   legend_title = "Czy obawiasz się, że będziesz musiała / musiał zrezygnować z doktoratu z powodu nowej sytuacji finansowej?",
                   COLOR = COLORS[2:1],
                   plot_title = question_show(question = "qn_34"))
cap <- sprintf("Z %i doktorantek i doktorantów aż %i utraciło źródło dochodu w związku z wprowadzonymi przez Rząd restrykcjami. Jednocześnie aż %i doktorantów i doktorantek obawia się, że będzie musiała zrezygnować z pisania doktoratu z powodu trudnej sytuacji finansowej, nie ma tutaj znaczenia czy utracili dochód czy nie.",
               compute_number(question = qn_34, response = "Tak") + compute_number(question = qn_34, response = "Nie"),
               compute_number(question = qn_34, response = "Tak"),
               compute_number(question = qn_36, response = "Tak"))
```

```{r social-zapomoga,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_34,
                   conditional = TRUE,
                   question2 = qn_35,
                   legend_title = "Czy wiesz jak uzyskać zapomogę?",
                   COLOR = COLORS[2:1],
                   plot_title = question_show(question = "qn_34"))
cap <- sprintf("Z %i doktorantek i doktorantów aż %i utraciło źródło dochodu w związku z wprowadzonymi przez Rząd restrykcjami. Jednocześnie mniej niż połowa (%i) z nich wie jak uzyskać zapomogę.",
               compute_number(question = qn_34, response = "Tak") + compute_number(question = qn_34, response = "Nie"),
               compute_number(question = qn_34, response = "Tak"),
               compute_number(question = qn_34, response = "Tak", conditional = TRUE, question2 = qn_35, response2 = "Tak"))
```

```{r social-doktorat,  layout="l-body-outset", fig.cap=cap}
plot_con_questions(question = qn_36,
                   conditional = TRUE,
                   question2 = qn_35,
                   legend_title = "Czy wiesz jak uzyskać zapomogę?",
                   COLOR = COLORS[2:1],
                   plot_title = question_show(question = "qn_36"))
cap <- sprintf("Z %i doktorantek i doktorantów aż %i obawia się, że będzie musiała zrezygnować z doktoratu z powodu trudnej sytucaji finansowej. Jednocześnie tylko %i z nich wie jak uzyskać zapomogę.",
               compute_number(question = qn_36, response = "Tak") + compute_number(question = qn_36, response = "Nie"),
               compute_number(question = qn_36, response = "Tak"),
               compute_number(question = qn_36, response = "Tak", conditional = TRUE, question2 = qn_35, response2 = "Tak"))
```

# Promotorzy

```{r promo,  layout="l-body-outset", fig.cap=cap}
cap <- sprintf(
  "Dla przeważającej większości (%i) doktorantek i doktorantów kontakt z Promotorką / Promotorem (Opiekunem / Opiekunką naukową) mimo szeregu ograniczeń w funkcjonowaniu Uniwersytetu Warszawskiego pozostał bez zmian lub się polepszył. Jednak dla aż %i obecna sytuacja wpłynęła na pogorszenie się tego kontaktu.",
  compute_number(question = qn_37, response = 3) + compute_number(question = qn_37, response = 5) + compute_number(question = qn_37, response = 4),
  compute_number(question = qn_37, response = 1) + compute_number(question = qn_37, response = 2))

plot_con_questions(question = scale,
                   conditional = TRUE,
                   question2 = position,
                   legend_title = "",
                   COLOR = COLORS[2:1],
                   ymin = 300,
                   ymax = 330,
                   plot_title = "Na ile zmienił się Twój kontakt z Promotorką / Promotorem (Opiekunem / Opiekunką naukową) podczas pandemii?")
```


```{r promo-call,  layout="l-body-outset", fig.cap=cap}
cap <- sprintf("Większość (%i) doktorantek i doktorantów rozmawiała ze swoją Promotorką / Promotorem (Opiekunką / Opiekunem naukowym) w ciągu ostatnich dwóch tygodni. Jednakże jest też spora grupa %i doktorantek i doktorantów, która od ponad dwóch tygodni nie miała kontaktu ze swoją Promotorką / Promotorem (Opiekunką / Opiekunem naukowym). Co mało zaskakujące spora ich część uważa, że ich kontakt się pogorszył (%i)",
               compute_number(question = contact_label, response = "W ciągu ostatnich 2 tygodnii"),
               compute_number(question = contact_label, response = "Nie rozmawialiśmy / rozmawiałyśmy \nod 2 tygodni"),
               compute_number(question = contact_label, response = "Nie rozmawialiśmy / rozmawiałyśmy \nod 2 tygodni", conditional = TRUE, question2 = scale, response2 = "Jest gorzej"))

plot_con_questions(question = contact_label,
                   conditional = TRUE,
                   question2 = scale,
                   legend_title = "Na ile zmienił się Twój kontakt z Promotorką / Promotorem (Opiekunem / Opiekunką naukową) podczas pandemii?",
                   reorder = TRUE,
                   COLOR = COLORS[2:1],
                   ymin = 150,
                   ymax = 180,
                   plot_title = "Kiedy ostatnio rozmawiałaś / rozmawiałeś ze swoją Promotorką / Promotorem (Opikunem / Opiekunką naukową) przez telefon lub przy użyciu dostępnych narzędzi informatycznych?")
```

# Dodatkowe pytanie

Przefiltrowałem odpowiedzi, żeby usunąć pojedyncze bluzgi i odpowiedzi typu, że nie ma się nic do powiedzenia. Moim zdaniem warto przejrzeć, bo nie jest ich jakoś szczególnie dużo. Jest parę odpowiedzi, które zwróciły moją uwagę. Między innymi te które mówią o kondycji psychicznej doktorantów wprost (16, 27, 33, 73, 75, 94, 119), i te które robią to nie wprost pisząc o ogólnym niepokoju i niepewności związanej z przyszłością (1, 3, 4, 9, 11, 12, 20, 22, 23, 25, 30, 34, 37, 38, 39, 40, 41, 44, 47, 55, 57, 62, 71, 75, 77, 81, 85, 88, 90, 91, 92, 97, 108, 109, 110, 114, 120, 124). Choć te drugie głównie dotyczą albo braku informacji albo niepewności finansowej związanej ze stypendium. Poza tym jest jedna odpowiedź w której ktoś pozdrawia Panią Rektor (49) i jedna specjalnie dla Natalii i Kasi specjalnie (72). Powtarzającym się motywem są też problemy z dziećmi, ale tych już nie wypisywałem.

```{r table, fig.width=8, layout="l-body-outset"}
cap = question_show(question = "qn_46")
data_wide %>%
  filter(!is.na(qn_46)) %>%
  filter(nchar(qn_46) > 10) %>%
  filter(!qn_46 %in% c("nie dotyczy",
                       "Nie mam uwag.",
                       "Nie mam pomysłów",
                       "Nie dotyczy",
                       "Nie powinno być tak, że aby wypełnić ankietę obligatoryjne jest polecenie serialu.....")) %>%
  select(Jednostka =  faculty_label, Odpowiedź = qn_46) %>%
  ungroup(id) %>%
  mutate(id = 1:n()) %>%
  kable(caption = cap, "html") %>%
   kable_styling(bootstrap_options = c("striped","hover"),
                font_size = 10,
                full_width = TRUE) %>%
  scroll_box(width = "100%", height = "600px")

```


# TV

Dość sztampowe są te odpowiedzi.

```{r series, fig.height=6, layout="l-body-outset"}
data_series <- read_delim("data/results_series.csv", ";") %>%
  select(id, time, language, affiliation = qn_1, position = qn_2, przewod =  qn_5, teaching =  qn_13, classes = qn_21, series = qn_47) %>%
  mutate(series = strsplit(series, ";")) %>% 
  unnest(series) %>%
  mutate(series = trimws(series))

SERIES_MAP = list(
  "La casa del papel" = c("Dom z papieru", "Dom z Papieru"),
  "Unorthodox" = c("Unorthodox", "Unorhtodox"),
  "Breaking Bad" = c("Breaking Bad","Breaking bad"),
  "Friends" = c("Friends"),
  "Westworld" = c("Westworld", "West World"),
  "Ozark" = c("Ozark", "Ozarak"),
  "Peaky Blinders" = c("Peaky Blinders"),
  "The Suits" = c("Suits"),
  "Stranger Things" = c("Stranger Things"),
  "Better Call Saul" = c("Better Call Saul", "Better call Saul"),
  "Freud" = c("Freud"),
  "The Good Place" = c("The good place", "Good place", "The Good place"),
  "The Witcher" = c("Wiedźmin"),
  "BoJack Horseman" = c("Bojack Horseman", "BoJack Horseman"),
  "Twin Peaks" = c("Twin Peaks", "Twin peaks"),
  "Broadchurch" = c("Broadchurch", "Boradchurch"),
  "Brooklyn 9-9" = c("Brooklyn 99")
)

map_table <- tibble(label = names(SERIES_MAP),
       series = map_depth(SERIES_MAP,1, as.vector)) %>%
  unnest(series)



data_series %>%
  left_join(map_table) %>%
  filter(!is.na(label)) %>%
  group_by(label) %>%
  summarise(count = n()) %>%
  arrange((count)) %>%
  mutate(label = as_factor(label)) %>%
  ggplot(aes(x = label, y = count)) +
  stat_summary(geom = "bar", show.legend = FALSE, fill = "#123e65") +
  theme_classic() +
  labs(x = "The title of the TV Series", y = "Frequency")+ 
  #annotation_custom(l, xmin = 0, xmax = 2, ymin = 36, ymax = 46) + 
  #coord_cartesian(clip = "off") +
  coord_flip() +
  scale_y_continuous(expand = expansion(mult = c(0, .1))) +
  theme(plot.margin = margin(30,30,30,30))
```
